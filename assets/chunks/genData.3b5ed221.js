import{_ as Re,o as Tt,c as Mt,k as q,r as Le,t as ls,u as cs,h as hs,j as us,H as Xt,w as Yt,l as Ht,e as oe,p as ds,m as gs}from"./framework.fbdba653.js";function at(n,t){if(!(!rt(n)&&!rt(t))){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const s=n[e],i=t[e];rt(i)&&rt(s)&&!nt(i)&&!nt(s)?at(s,i):X(t[e])&&(n[e]=t[e])}}}function Be(n){if(!rt(n)||!nt(n))return n;let t;nt(n)?t=[]:t={};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const s=n[e];rt(s)?t[e]=Be(s):t[e]=s}return t}function nt(n){return Object.prototype.toString.call(n)==="[object Array]"}function Ot(n){return typeof n=="function"}function rt(n){return typeof n=="object"}function Wt(n){return typeof n=="number"&&!isNaN(n)}function X(n){return n!=null}function fs(n){return typeof n=="boolean"}function ot(n){return typeof n=="string"}const ms=/\\(\\)?/g,ps=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function N(n,t,e){if(X(n)){const s=[];t.replace(ps,(a,...l)=>{let c=a;return X(l[1])?c=l[2].replace(ms,"$1"):X(l[0])&&(c=l[0].trim()),s.push(c),""});let i=n,o=0;const r=s.length;for(;X(i)&&o<r;)i=i==null?void 0:i[s[o++]];return X(i)?i:e??"--"}return e??"--"}function _s(n,t,e){const i=n.format(new Date(t)).split(", "),o=i[0].split("/"),r=i[1].split(":"),a={YYYY:o[2],MM:o[0],DD:o[1],HH:r[0]==="24"?"00":r[0],mm:r[1],ss:r[2]};return e.replace(/YYYY|MM|DD|HH|mm|ss/g,l=>a[l])}function z(n,t){const e=+n;return Wt(e)?e.toFixed(t??2):`${n}`}function vs(n){const t=+n;if(Wt(t)){if(t>1e9)return`${+(t/1e9).toFixed(3)}B`;if(t>1e6)return`${+(t/1e6).toFixed(3)}M`;if(t>1e3)return`${+(t/1e3).toFixed(3)}K`}return`${n}`}function Y(n,t){const e=`${n}`;if(t.length===0)return e;if(e.includes(".")){const s=e.split(".");return`${s[0].replace(/(\d)(?=(\d{3})+$)/g,i=>`${i}${t}`)}.${s[1]}`}return e.replace(/(\d)(?=(\d{3})+$)/g,s=>`${s}${t}`)}var J=(n=>(n.Dashed="dashed",n.Solid="solid",n))(J||{}),R=(n=>(n.Stroke="stroke",n.Fill="fill",n.StrokeFill="stroke_fill",n))(R||{}),ae=(n=>(n.Always="always",n.FollowCross="follow_cross",n.None="none",n))(ae||{}),St=(n=>(n.Standard="standard",n.Rect="rect",n))(St||{}),Zt=(n=>(n.Left="left",n.Middle="middle",n.Right="right",n))(Zt||{});function xs(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",dashedValue:[2,2]}}}var Ve=(n=>(n.Fixed="fixed",n.Pointer="pointer",n))(Ve||{}),pt=(n=>(n.CandleSolid="candle_solid",n.CandleStroke="candle_stroke",n.CandleUpStroke="candle_up_stroke",n.CandleDownStroke="candle_down_stroke",n.Ohlc="ohlc",n.Area="area",n))(pt||{});function Ss(){return{type:"candle_solid",bar:{upColor:"#2DC08E",downColor:"#F92855",noChangeColor:"#888888",upBorderColor:"#2DC08E",downBorderColor:"#F92855",noChangeBorderColor:"#888888",upWickColor:"#2DC08E",downWickColor:"#F92855",noChangeWickColor:"#888888"},area:{lineSize:2,lineColor:"#1677FF",value:"close",backgroundColor:[{offset:0,color:"rgba(22, 119, 255, 0.01)"},{offset:1,color:"rgba(22, 119, 255, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#2DC08E",downColor:"#F92855",noChangeColor:"#888888",line:{show:!0,style:"dashed",dashedValue:[4,4],size:1},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:"always",showType:"standard",custom:null,defaultValue:"n/a",rect:{position:"fixed",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:8,offsetLeft:10,offsetTop:8,offsetRight:10,offsetBottom:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:10,marginTop:8,marginRight:6,marginBottom:0},icons:[]}}}function Cs(){return{ohlc:{upColor:"rgba(45, 192, 142, .7)",downColor:"rgba(249, 40, 85, .7)",noChangeColor:"#888888"},bars:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(45, 192, 142, .7)",downColor:"rgba(249, 40, 85, .7)",noChangeColor:"#888888"}],lines:[{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#FF9600"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#935EBD"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#1677FF"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#E11D74"},{style:"solid",smooth:!1,size:1,dashedValue:[2,2],color:"#01C5C4"}],circles:[{style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:"rgba(45, 192, 142, .7)",downColor:"rgba(249, 40, 85, .7)",noChangeColor:"#888888"}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:1,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{showRule:"always",showType:"standard",showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:10,marginTop:8,marginRight:6,marginBottom:0},icons:[]}}}function ys(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}var Pt=(n=>(n.Left="left",n.Right="right",n))(Pt||{}),$=(n=>(n.Normal="normal",n.Percentage="percentage",n.Log="log",n))($||{});function bs(){return{show:!0,size:"auto",type:"normal",position:"right",inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function ws(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:"#686D76",borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#686D76",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}}}}function Is(){return{point:{color:"#1677FF",borderColor:"rgba(22, 119, 255, 0.35)",borderSize:1,radius:5,activeColor:"#1677FF",activeBorderColor:"rgba(22, 119, 255, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:"solid",smooth:!1,color:"#1677FF",size:1,dashedValue:[2,2]},rect:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{style:"fill",color:"#1677FF",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{style:"fill",color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{style:"solid",color:"#1677FF",size:1,dashedValue:[2,2]},text:{style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:0,borderRadius:2,borderColor:"#1677FF",paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,backgroundColor:"transparent"},rectText:{style:"fill",color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"}}}function Es(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"}}function Ts(){return{grid:xs(),candle:Ss(),indicator:Cs(),xAxis:ys(),yAxis:bs(),separator:Es(),crosshair:ws(),overlay:Is()}}var Z=(n=>(n[n.Tooltip=0]="Tooltip",n[n.Crosshair=1]="Crosshair",n[n.XAxis=2]="XAxis",n))(Z||{});function Ms(){return{formatDate:_s,formatBigNumber:vs}}const Ds="en-US";var A=(n=>(n[n.Main=0]="Main",n[n.Overlay=1]="Overlay",n[n.Separator=2]="Separator",n[n.Drawer=3]="Drawer",n[n.All=4]="All",n))(A||{}),lt=(n=>(n.OnZoom="onZoom",n.OnScroll="onScroll",n.OnVisibleRangeChange="onVisibleRangeChange",n.OnTooltipIconClick="onTooltipIconClick",n.OnCrosshairChange="onCrosshairChange",n.OnCandleBarClick="onCandleBarClick",n.OnPaneDrag="onPaneDrag",n))(lt||{});class Ps{constructor(){this._callbacks=[]}subscribe(t){(this._callbacks.indexOf(t)??-1)<0&&this._callbacks.push(t)}unsubscribe(t){if(t!==void 0){const e=this._callbacks.indexOf(t)??-1;e>-1&&this._callbacks.splice(e,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach(e=>{e(t)})}isEmpty(){return this._callbacks.length===0}}let ne=1,Ee=new Date().getTime();function Ne(n){const t=new Date().getTime();return t===Ee?++ne:ne=1,Ee=t,`${n??""}${t}_${ne}`}function ct(n,t){const e=document.createElement(n),s=t??{};for(const i in s)e.style[i]=s[i]??"";return e}let Bt;function yt(n){var t,e;return Math.ceil(((e=(t=n.ownerDocument)==null?void 0:t.defaultView)==null?void 0:e.devicePixelRatio)??2)}function bt(n,t,e){return`${t??"normal"} ${n??12}px ${e??"Helvetica Neue"}`}function jt(n,t,e,s){if(Bt===void 0){const i=document.createElement("canvas"),o=yt(i);Bt=i.getContext("2d"),Bt.scale(o,o)}return Bt.font=bt(t,e,s),Math.round(Bt.measureText(n).width)}function le(n,t,e){let s=0,i=0;for(i=n.length-1;s!==i;){const o=Math.floor((i+s)/2),r=i-s,a=n[o][t];if(e===n[s][t])return s;if(e===n[i][t])return i;if(e===a)return o;if(e>a?s=o:i=o,r<=2)break}return s}function As(n){const t=Math.floor(Nt(n)),e=Ct(t),s=n/e;let i=0;return s<1.5?i=1:s<2.5?i=2:s<3.5?i=3:s<4.5?i=4:s<5.5?i=5:s<6.5?i=6:i=8,n=i*e,t>=-20?+n.toFixed(t<0?-t:0):n}function Te(n,t){return t==null&&(t=10),t=Math.min(Math.max(0,t),20),+(+n).toFixed(t)}function ks(n){const t=n.toString(),e=t.indexOf("e");if(e>0){const s=+t.slice(e+1);return s<0?-s:0}else{const s=t.indexOf(".");return s<0?0:t.length-1-s}}function Oe(n,t,e){const s=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return n.forEach(i=>{s[0]=Math.max(i[t]??i,s[0]),s[1]=Math.min(i[e]??i,s[1])}),s}function Nt(n){return Math.log(n)/Math.log(10)}function Ct(n){return Math.pow(10,n)}function Me(){return{from:0,to:0,realFrom:0,realTo:0}}const De={MIN:1,MAX:50},Fs=6,Rs=50;class Ls{constructor(t){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalBarSpace=0,this._barSpace=Fs,this._offsetRightDistance=Rs,this._startScrollOffsetRightBarCount=0,this._minVisibleBarCount={left:2,right:2},this._visibleRange=Me(),this._chartStore=t,this._gapBarSpace=this._calcGapBarSpace(),this._offsetRightBarCount=this._offsetRightDistance/this._barSpace}_calcGapBarSpace(){const t=Math.floor(this._barSpace*.82),e=Math.floor(this._barSpace),s=Math.min(t,e-1);return Math.max(1,s)}adjustVisibleRange(){const t=this._chartStore.getDataList(),e=t.length,s=this._totalBarSpace/this._barSpace,i=s-Math.min(this._minVisibleBarCount.left,e);this._offsetRightBarCount>i&&(this._offsetRightBarCount=i);const o=-e+Math.min(this._minVisibleBarCount.right,e);this._offsetRightBarCount<o&&(this._offsetRightBarCount=o);let r=Math.round(this._offsetRightBarCount+e+.5);r>e&&(r=e);let a=Math.round(r-s)-1;a<0&&(a=0);const l=this._offsetRightBarCount>0?Math.round(e+this._offsetRightBarCount-s)-1:a;if(this._visibleRange={from:a,to:r,realFrom:l,realTo:r},this._chartStore.getActionStore().execute(lt.OnVisibleRangeChange,this._visibleRange),this._chartStore.adjustVisibleDataList(),a===0&&this._more&&!this._loading&&this._loadMoreCallback!==null){this._loading=!0;const c=t[0];this._loadMoreCallback((c==null?void 0:c.timestamp)??null)}}setMore(t){return this._more=t,this}setLoading(t){return this._loading=t,this}getDateTimeFormat(){return this._dateTimeFormat}_buildDateTimeFormat(t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};t!==void 0&&(e.timeZone=t);let s=null;try{s=new Intl.DateTimeFormat("en",e)}catch{}return s}setTimezone(t){const e=this._buildDateTimeFormat(t);e!==null&&(this._dateTimeFormat=e)}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}}setBarSpace(t,e){t<De.MIN||t>De.MAX||this._barSpace===t||(this._barSpace=t,this._gapBarSpace=this._calcGapBarSpace(),e==null||e(),this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))}setTotalBarSpace(t){return this._totalBarSpace!==t&&(this._totalBarSpace=t,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0)),this}setOffsetRightDistance(t,e){return this._offsetRightDistance=t,this._offsetRightBarCount=t/this._barSpace,(e??!1)&&(this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this}resetOffsetRightDistance(){this.setOffsetRightDistance(this._offsetRightDistance)}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._offsetRightBarCount*this._barSpace)}getOffsetRightBarCount(){return this._offsetRightBarCount}setOffsetRightBarCount(t){return this._offsetRightBarCount=t,this}setLeftMinVisibleBarCount(t){return this._minVisibleBarCount.left=t,this}setRightMinVisibleBarCount(t){return this._minVisibleBarCount.right=t,this}getVisibleRange(){return this._visibleRange}startScroll(){this._startScrollOffsetRightBarCount=this._offsetRightBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace;this._chartStore.getActionStore().execute(lt.OnScroll),this._offsetRightBarCount=this._startScrollOffsetRightBarCount-e,this.adjustVisibleRange(),this._chartStore.getTooltipStore().recalculateCrosshair(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}getDataByDataIndex(t){return this._chartStore.getDataList()[t]??null}coordinateToFloatIndex(t){const e=this._chartStore.getDataList().length,s=(this._totalBarSpace-t)/this._barSpace,i=e+this._offsetRightBarCount-s;return Math.round(i*1e6)/1e6}dataIndexToTimestamp(t){const e=this.getDataByDataIndex(t);return(e==null?void 0:e.timestamp)??null}timestampToDataIndex(t){const e=this._chartStore.getDataList();return e.length===0?0:le(e,"timestamp",t)}dataIndexToCoordinate(t){const s=this._chartStore.getDataList().length+this._offsetRightBarCount-t;return this._totalBarSpace-(s-.5)*this._barSpace}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e){if(!this._zoomEnabled)return;if((e==null?void 0:e.x)===void 0){const o=this._chartStore.getTooltipStore().getCrosshair();e={x:(o==null?void 0:o.x)??this._totalBarSpace/2}}this._chartStore.getActionStore().execute(lt.OnZoom);const s=this.coordinateToFloatIndex(e.x),i=this._barSpace+t*(this._barSpace/10);this.setBarSpace(i,()=>{this._offsetRightBarCount+=s-this.coordinateToFloatIndex(e==null?void 0:e.x)})}setZoomEnabled(t){return this._zoomEnabled=t,this}getZoomEnabled(){return this._zoomEnabled}setScrollEnabled(t){return this._scrollEnabled=t,this}getScrollEnabled(){return this._scrollEnabled}setLoadMoreCallback(t){return this._loadMoreCallback=t,this}clear(){this._more=!0,this._loading=!0,this._visibleRange=Me()}}var et=(n=>(n.Normal="normal",n.Price="price",n.Volume="volume",n))(et||{});function ue(n,t,e,s,i){const o=t.result,r=t.figures,a=t.styles,l=N(a,"circles",s.circles),c=l.length,h=N(a,"bars",s.bars),u=h.length,d=N(a,"lines",s.lines),g=d.length;let m=0,f=0,_=0,p;r.forEach(v=>{var x;switch(v.type){case"circle":{const S=l[m%c];p={...S,color:S.noChangeColor},m++;break}case"bar":{const S=h[f%u];p={...S,color:S.noChangeColor},f++;break}case"line":{p=d[_%g],_++;break}}if(X(p)){const S={prev:{kLineData:n[e-1],indicatorData:o[e-1]},current:{kLineData:n[e],indicatorData:o[e]},next:{kLineData:n[e+1],indicatorData:o[e+1]}},y=(x=v.styles)==null?void 0:x.call(v,S,t,s);i(v,{...p,...y})}})}class Jt{constructor(t){this.result=[],this._precisionFlag=!1;const{name:e,shortName:s,series:i,calcParams:o,figures:r,precision:a,shouldOhlc:l,shouldFormatBigNumber:c,visible:h,minValue:u,maxValue:d,styles:g,extendData:m,regenerateFigures:f,createTooltipDataSource:_,draw:p}=t;this.name=e,this.shortName=s??e,this.series=i??"normal",this.precision=a??4,this.calcParams=o??[],this.figures=r??[],this.shouldOhlc=l??!1,this.shouldFormatBigNumber=c??!1,this.visible=h??!0,this.minValue=u??null,this.maxValue=d??null,this.styles=g??{},this.extendData=m,this.regenerateFigures=f??null,this.createTooltipDataSource=_??null,this.draw=p??null}setShortName(t){return this.shortName!==t?(this.shortName=t,!0):!1}setSeries(t){return this.series!==t?(this.series=t,!0):!1}setPrecision(t,e){const s=e??!1,i=Math.floor(t);return i!==this.precision&&t>=0&&(!s||s&&!this._precisionFlag)?(this.precision=i,s||(this._precisionFlag=!0),!0):!1}setCalcParams(t){var e;return this.calcParams=t,this.figures=((e=this.regenerateFigures)==null?void 0:e.call(this,t))??this.figures,!0}setShouldOhlc(t){return this.shouldOhlc!==t?(this.shouldOhlc=t,!0):!1}setShouldFormatBigNumber(t){return this.shouldFormatBigNumber!==t?(this.shouldFormatBigNumber=t,!0):!1}setVisible(t){return this.visible!==t?(this.visible=t,!0):!1}setStyles(t){return t!==null?(at(this.styles,t),!0):!1}setExtendData(t){return this.extendData!==t?(this.extendData=t,!0):!1}setFigures(t){return this.figures!==t?(this.figures=t,!0):!1}setMinValue(t){return this.minValue!==t?(this.minValue=t,!0):!1}setMaxValue(t){return this.maxValue!==t?(this.maxValue=t,!0):!1}setRegenerateFigures(t){return this.regenerateFigures!==t?(this.regenerateFigures=t,!0):!1}setCreateTooltipDataSource(t){return this.createTooltipDataSource!==t?(this.createTooltipDataSource=t,!0):!1}setDraw(t){return this.draw!==t?(this.draw=t,!0):!1}async calcIndicator(t){try{const e=await this.calc(t,this);return this.result=e,!0}catch{return!1}}static extend(t){class e extends Jt{constructor(){super(t)}calc(i,o){return t.calc(i,o)}}return e}}const Bs={name:"AVP",shortName:"AVP",series:et.Price,precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:n=>{let t=0,e=0;return n.map(s=>{const i={},o=(s==null?void 0:s.turnover)??0,r=(s==null?void 0:s.volume)??0;return t+=o,e+=r,e!==0&&(i.avp=t/e),i})}},Vs={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:(n,t,e)=>{var c,h;const{prev:s,current:i}=n,o=((c=s.indicatorData)==null?void 0:c.ao)??Number.MIN_SAFE_INTEGER,r=((h=i.indicatorData)==null?void 0:h.ao)??Number.MIN_SAFE_INTEGER;let a;r>o?a=N(t.styles,"bars[0].upColor",e.bars[0].upColor):a=N(t.styles,"bars[0].downColor",e.bars[0].downColor);const l=r>o?R.Stroke:R.Fill;return{color:a,style:l,borderColor:a}}}],calc:(n,t)=>{const e=t.calcParams,s=Math.max(e[0],e[1]);let i=0,o=0,r=0,a=0;return n.map((l,c)=>{const h={},u=(l.low+l.high)/2;if(i+=u,o+=u,c>=e[0]-1){r=i/e[0];const d=n[c-(e[0]-1)];i-=(d.low+d.high)/2}if(c>=e[1]-1){a=o/e[1];const d=n[c-(e[1]-1)];o-=(d.low+d.high)/2}return c>=s-1&&(h.ao=r-a),h})}},Ns={name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:n=>n.map((t,e)=>({key:`bias${e+1}`,title:`BIAS${t}: `,type:"line"})),calc:(n,t)=>{const{calcParams:e,figures:s}=t,i=[];return n.map((o,r)=>{const a={},l=o.close;return e.forEach((c,h)=>{if(i[h]=(i[h]??0)+l,r>=c-1){const u=i[h]/e[h];a[s[h].key]=(l-u)/u*100,i[h]-=n[r-(c-1)].close}}),a})}};function Os(n,t){const e=n.length;let s=0;return n.forEach(i=>{const o=i.close-t;s+=o*o}),s=Math.abs(s),Math.sqrt(s/e)}const Ws={name:"BOLL",shortName:"BOLL",series:et.Price,calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=e[0]-1;let i=0;return n.map((o,r)=>{const a=o.close,l={};if(i+=a,r>=s){l.mid=i/e[0];const c=Os(n.slice(r-s,r+1),l.mid);l.up=l.mid+e[1]*c,l.dn=l.mid-e[1]*c,i-=n[r-s].close}return l})}},zs={name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i=0,o=0,r=0;return n.map((a,l)=>{const c={},h=a.high,u=a.low,d=a.open,g=(n[l-1]??a).close;if(o+=h-d,r+=d-u,s+=h-g,i+=g-u,l>=e[0]-1){r!==0?c.ar=o/r*100:c.ar=0,i!==0?c.br=s/i*100:c.br=0;const m=n[l-(e[0]-1)],f=m.high,_=m.low,p=m.open,v=(n[l-e[0]]??n[l-(e[0]-1)]).close;s-=f-v,i-=v-_,o-=f-p,r-=p-_}return c})}},Xs={name:"BBI",shortName:"BBI",series:et.Price,precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=Math.max(...e),i=[],o=[];return n.map((r,a)=>{const l={},c=r.close;if(e.forEach((h,u)=>{i[u]=(i[u]??0)+c,a>=h-1&&(o[u]=i[u]/h,i[u]-=n[a-(h-1)].close)}),a>=s-1){let h=0;o.forEach(u=>{h+=u}),l.bbi=h/4}return l})}},Ys={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=e[0]-1;let i=0;const o=[];return n.map((r,a)=>{const l={},c=(r.high+r.low+r.close)/3;if(i+=c,o.push(c),a>=s){const h=i/e[0],u=o.slice(a-s,a+1);let d=0;u.forEach(f=>{d+=Math.abs(f-h)});const g=d/e[0];l.cci=g!==0?(c-h)/g/.015:0;const m=(n[a-s].high+n[a-s].low+n[a-s].close)/3;i-=m}return l})}},Hs={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=Math.ceil(e[1]/2.5+1),i=Math.ceil(e[2]/2.5+1),o=Math.ceil(e[3]/2.5+1),r=Math.ceil(e[4]/2.5+1);let a=0;const l=[];let c=0;const h=[];let u=0;const d=[];let g=0;const m=[],f=[];return n.forEach((_,p)=>{const v={},x=n[p-1]??_,S=(x.high+x.close+x.low+x.open)/4,y=Math.max(0,_.high-S),C=Math.max(0,S-_.low);p>=e[0]-1&&(C!==0?v.cr=y/C*100:v.cr=0,a+=v.cr,c+=v.cr,u+=v.cr,g+=v.cr,p>=e[0]+e[1]-2&&(l.push(a/e[1]),p>=e[0]+e[1]+s-3&&(v.ma1=l[l.length-1-s]),a-=f[p-(e[1]-1)].cr??0),p>=e[0]+e[2]-2&&(h.push(c/e[2]),p>=e[0]+e[2]+i-3&&(v.ma2=h[h.length-1-i]),c-=f[p-(e[2]-1)].cr??0),p>=e[0]+e[3]-2&&(d.push(u/e[3]),p>=e[0]+e[3]+o-3&&(v.ma3=d[d.length-1-o]),u-=f[p-(e[3]-1)].cr??0),p>=e[0]+e[4]-2&&(m.push(g/e[4]),p>=e[0]+e[4]+r-3&&(v.ma4=m[m.length-1-r]),g-=f[p-(e[4]-1)].cr??0)),f.push(v)}),f}},$s={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=Math.max(e[0],e[1]);let i=0,o=0,r=0;const a=[];return n.forEach((l,c)=>{const h={},u=l.close;i+=u,o+=u;let d=0,g=0;if(c>=e[0]-1&&(d=i/e[0],i-=n[c-(e[0]-1)].close),c>=e[1]-1&&(g=o/e[1],o-=n[c-(e[1]-1)].close),c>=s-1){const m=d-g;h.dma=m,r+=m,c>=s+e[2]-2&&(h.ama=r/e[2],r-=a[c-(e[2]-1)].dma??0)}a.push(h)}),a}},Zs={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i=0,o=0,r=0,a=0,l=0,c=0,h=0;const u=[];return n.forEach((d,g)=>{const m={},f=n[g-1]??d,_=f.close,p=d.high,v=d.low,x=p-v,S=Math.abs(p-_),y=Math.abs(_-v),C=p-f.high,b=f.low-v,w=Math.max(Math.max(x,S),y),E=C>0&&C>b?C:0,T=b>0&&b>C?b:0;if(s+=w,i+=E,o+=T,g>=e[0]-1){g>e[0]-1?(r=r-r/e[0]+w,a=a-a/e[0]+E,l=l-l/e[0]+T):(r=s,a=i,l=o);let I=0,k=0;r!==0&&(I=a*100/r,k=l*100/r),m.pdi=I,m.mdi=k;let L=0;k+I!==0&&(L=Math.abs(k-I)/(k+I)*100),c+=L,g>=e[0]*2-2&&(g>e[0]*2-2?h=(h*(e[0]-1)+L)/e[0]:h=c/e[0],m.adx=h,g>=e[0]*2+e[1]-3&&(m.adxr=((u[g-(e[1]-1)].adx??0)+h)/2))}u.push(m)}),u}},Gs={name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0;const i=[];return n.map((o,r)=>{const a={};if(r>0){const l=n[r-1],c=o.high,h=o.low,u=o.volume??0,d=(c+h)/2-(l.high+l.low)/2;if(u===0||c-h===0)a.emv=0;else{const g=u/1e8/(c-h);a.emv=d/g}s+=a.emv,i.push(a.emv),r>=e[0]&&(a.maEmv=s/e[0],s-=i[r-e[0]])}return a})}},js={name:"EMA",shortName:"EMA",series:et.Price,calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:n=>n.map((t,e)=>({key:`ema${e+1}`,title:`EMA${t}: `,type:"line"})),calc:(n,t)=>{const{calcParams:e,figures:s}=t;let i=0;const o=[];return n.map((r,a)=>{const l={},c=r.close;return i+=c,e.forEach((h,u)=>{a>=h-1&&(a>h-1?o[u]=(2*c+(h-1)*o[u])/(h+1):o[u]=i/h,l[s[u].key]=o[u])}),l})}},Us={name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0;const i=[];return n.forEach((o,r)=>{const a={};if(r>=e[0]){const l=o.close,c=n[r-e[0]].close;a.mtm=l-c,s+=a.mtm,r>=e[0]+e[1]-1&&(a.maMtm=s/e[1],s-=i[r-(e[1]-1)].mtm??0)}i.push(a)}),i}},qs={name:"MA",shortName:"MA",series:et.Price,calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:n=>n.map((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"})),calc:(n,t)=>{const{calcParams:e,figures:s}=t,i=[];return n.map((o,r)=>{const a={},l=o.close;return e.forEach((c,h)=>{i[h]=(i[h]??0)+l,r>=c-1&&(a[s[h].key]=i[h]/c,i[h]-=n[r-(c-1)].close)}),a})}},Ks={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:(n,t,e)=>{var c,h;const{prev:s,current:i}=n,o=((c=s.indicatorData)==null?void 0:c.macd)??Number.MIN_SAFE_INTEGER,r=((h=i.indicatorData)==null?void 0:h.macd)??Number.MIN_SAFE_INTEGER;let a;return r>0?a=N(t.styles,"bars[0].upColor",e.bars[0].upColor):r<0?a=N(t.styles,"bars[0].downColor",e.bars[0].downColor):a=N(t.styles,"bars[0].noChangeColor",e.bars[0].noChangeColor),{style:o<r?R.Stroke:R.Fill,color:a,borderColor:a}}}],calc:(n,t)=>{const e=t.calcParams;let s=0,i,o,r=0,a=0,l=0;const c=Math.max(e[0],e[1]);return n.map((h,u)=>{const d={},g=h.close;return s+=g,u>=e[0]-1&&(u>e[0]-1?i=(2*g+(e[0]-1)*i)/(e[0]+1):i=s/e[0]),u>=e[1]-1&&(u>e[1]-1?o=(2*g+(e[1]-1)*o)/(e[1]+1):o=s/e[1]),u>=c-1&&(r=i-o,d.dif=r,a+=r,u>=c+e[2]-2&&(u>c+e[2]-2?l=(r*2+l*(e[2]-1))/(e[2]+1):l=a/e[2],d.macd=(r-l)*2,d.dea=l)),d})}},Js={name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i=0;const o=[];return n.forEach((r,a)=>{const l=n[a-1]??r;r.close<l.close?i-=r.volume??0:r.close>l.close&&(i+=r.volume??0);const c={obv:i};s+=i,a>=e[0]-1&&(c.maObv=s/e[0],s-=o[a-(e[0]-1)].obv??0),o.push(c)}),o}},Qs={name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:n=>{let t=0;return n.map((e,s)=>{const i={},o=e.close,r=e.volume??1,a=(n[s-1]??e).close;let l=0;const c=a*r;return c!==0&&(l=(o-a)/c),t+=l,i.pvt=t,i})}},ti={name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i=0;const o=[],r=[];return n.forEach((a,l)=>{const c={},h=(n[l-1]??a).close,u=a.close-h>0?1:0;o.push(u),s+=u,l>=e[0]-1&&(c.psy=s/e[0]*100,i+=c.psy,l>=e[0]+e[1]-2&&(c.maPsy=i/e[1],i-=r[l-(e[1]-1)].psy??0),s-=o[l-(e[0]-1)]),r.push(c)}),r}},ei={name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=[];let i=0;return n.forEach((o,r)=>{const a={};if(r>=e[0]-1){const l=o.close,c=(n[r-e[0]]??n[r-(e[0]-1)]).close;c!==0?a.roc=(l-c)/c*100:a.roc=0,i+=a.roc,r>=e[0]-1+e[1]-1&&(a.maRoc=i/e[1],i-=s[r-(e[1]-1)].roc??0)}s.push(a)}),s}},si={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:n=>n.map((t,e)=>{const s=e+1;return{key:`rsi${s}`,title:`RSI${s}: `,type:"line"}}),calc:(n,t)=>{const{calcParams:e,figures:s}=t,i=[],o=[];return n.map((r,a)=>{const l={},c=(n[a-1]??r).close,h=r.close-c;return e.forEach((u,d)=>{if(h>0?i[d]=(i[d]??0)+h:o[d]=(o[d]??0)+Math.abs(h),a>=u-1){o[d]!==0?l[s[d].key]=100-100/(1+i[d]/o[d]):l[s[d].key]=0;const g=n[a-(u-1)],m=n[a-u]??g,f=g.close-m.close;f>0?i[d]-=f:o[d]-=Math.abs(f)}}),l})}},ii={name:"SMA",shortName:"SMA",series:et.Price,calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(n,t)=>{const e=t.calcParams;let s=0,i=0;return n.map((o,r)=>{const a={},l=o.close;return s+=l,r>=e[0]-1&&(r>e[0]-1?i=(l*e[1]+i*(e[0]-e[1]+1))/(e[0]+1):i=s/e[0],a.sma=i),a})}},oi={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams,s=[];return n.forEach((i,o)=>{var l,c;const r={},a=i.close;if(o>=e[0]-1){const h=Oe(n.slice(o-(e[0]-1),o+1),"high","low"),u=h[0],d=h[1],g=u-d,m=(a-d)/(g===0?1:g)*100;r.k=((e[1]-1)*(((l=s[o-1])==null?void 0:l.k)??50)+m)/e[1],r.d=((e[2]-1)*(((c=s[o-1])==null?void 0:c.d)??50)+r.k)/e[2],r.j=3*r.k-2*r.d}s.push(r)}),s}},ni={name:"SAR",shortName:"SAR",series:et.Price,calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:(n,t,e)=>{var l;const{current:s}=n,i=((l=s.indicatorData)==null?void 0:l.sar)??Number.MIN_SAFE_INTEGER,o=s.kLineData,r=((o==null?void 0:o.high)+(o==null?void 0:o.low))/2;return{color:i<r?N(t.styles,"circles[0].upColor",e.circles[0].upColor):N(t.styles,"circles[0].downColor",e.circles[0].downColor)}}}],calc:(n,t)=>{const e=t.calcParams,s=e[0]/100,i=e[1]/100,o=e[2]/100;let r=s,a=-100,l=!1,c=0;return n.map((h,u)=>{const d=c,g=h.high,m=h.low;if(l){(a===-100||a<g)&&(a=g,r=Math.min(r+i,o)),c=d+r*(a-d);const f=Math.min(n[Math.max(1,u)-1].low,m);c>h.low?(c=a,r=s,a=-100,l=!l):c>f&&(c=f)}else{(a===-100||a>m)&&(a=m,r=Math.min(r+i,o)),c=d+r*(a-d);const f=Math.max(n[Math.max(1,u)-1].high,g);c<h.high?(c=a,r=0,a=-100,l=!l):c<f&&(c=f)}return{sar:c}})}},ri={name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i,o,r,a=0,l=0,c=0;const h=[];return n.forEach((u,d)=>{const g={},m=u.close;if(s+=m,d>=e[0]-1&&(d>e[0]-1?i=(2*m+(e[0]-1)*i)/(e[0]+1):i=s/e[0],a+=i,d>=e[0]*2-2&&(d>e[0]*2-2?o=(2*i+(e[0]-1)*o)/(e[0]+1):o=a/e[0],l+=o,d>=e[0]*3-3))){let f,_=0;d>e[0]*3-3?(f=(2*o+(e[0]-1)*r)/(e[0]+1),_=(f-r)/r*100):f=l/e[0],r=f,g.trix=_,c+=_,d>=e[0]*3+e[1]-4&&(g.maTrix=c/e[1],c-=h[d-(e[1]-1)].trix??0)}h.push(g)}),h}},ai={name:"VOL",shortName:"VOL",series:et.Volume,calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(n,t,e)=>{const s=n.current.kLineData;let i;return s.close>s.open?i=N(t.styles,"bars[0].upColor",e.bars[0].upColor):s.close<s.open?i=N(t.styles,"bars[0].downColor",e.bars[0].downColor):i=N(t.styles,"bars[0].noChangeColor",e.bars[0].noChangeColor),{color:i}}}],regenerateFigures:n=>{const t=n.map((e,s)=>({key:`ma${s+1}`,title:`MA${e}: `,type:"line"}));return t.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(e,s,i)=>{const o=e.current.kLineData;let r;return o.close>o.open?r=N(s.styles,"bars[0].upColor",i.bars[0].upColor):o.close<o.open?r=N(s.styles,"bars[0].downColor",i.bars[0].downColor):r=N(s.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:r}}}),t},calc:(n,t)=>{const{calcParams:e,figures:s}=t,i=[];return n.map((o,r)=>{const a=o.volume??0,l={volume:a};return e.forEach((c,h)=>{i[h]=(i[h]??0)+a,r>=c-1&&(l[s[h].key]=i[h]/c,i[h]-=n[r-(c-1)].volume??0)}),l})}},li={name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(n,t)=>{const e=t.calcParams;let s=0,i=0,o=0,r=0;const a=[];return n.forEach((l,c)=>{const h={},u=l.close,d=(n[c-1]??l).close,g=l.volume??0;if(u>d?s+=g:u<d?i+=g:o+=g,c>=e[0]-1){const m=o/2;i+m===0?h.vr=0:h.vr=(s+m)/(i+m)*100,r+=h.vr,c>=e[0]+e[1]-2&&(h.maVr=r/e[1],r-=a[c-(e[1]-1)].vr??0);const f=n[c-(e[0]-1)],_=n[c-e[0]]??f,p=f.close,v=f.volume??0;p>_.close?s-=v:p<_.close?i-=v:o-=v}a.push(h)}),a}},ci={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:n=>n.map((t,e)=>({key:`wr${e+1}`,title:`WR${e+1}: `,type:"line"})),calc:(n,t)=>{const{calcParams:e,figures:s}=t;return n.map((i,o)=>{const r={},a=i.close;return e.forEach((l,c)=>{const h=l-1;if(o>=h){const u=Oe(n.slice(o-h,o+1),"high","low"),d=u[0],g=u[1],m=d-g;r[s[c].key]=m===0?0:(a-d)/m*100}}),r})}},de={},hi=[Bs,Vs,Ns,Ws,zs,Xs,Ys,Hs,$s,Zs,Gs,js,Us,qs,Ks,Js,Qs,ti,ei,si,ii,oi,ni,ri,ai,li,ci];hi.forEach(n=>{de[n.name]=Jt.extend(n)});function nn(n){de[n.name]=Jt.extend(n)}function We(n){return de[n]??null}class ui{constructor(t){this._instances=new Map,this._chartStore=t}_overrideInstance(t,e){const{shortName:s,series:i,calcParams:o,precision:r,figures:a,minValue:l,maxValue:c,shouldOhlc:h,shouldFormatBigNumber:u,visible:d,styles:g,extendData:m,regenerateFigures:f,createTooltipDataSource:_,draw:p,calc:v}=e;let x=!1;s!==void 0&&t.setShortName(s)&&(x=!0),i!==void 0&&t.setSeries(i)&&(x=!0);let S=!1;return o!==void 0&&t.setCalcParams(o)&&(x=!0,S=!0),a!==void 0&&t.setFigures(a)&&(x=!0,S=!0),l!==void 0&&t.setMinValue(l)&&(x=!0),c!==void 0&&t.setMinValue(c)&&(x=!0),r!==void 0&&t.setPrecision(r)&&(x=!0),h!==void 0&&t.setShouldOhlc(h)&&(x=!0),u!==void 0&&t.setShouldFormatBigNumber(u)&&(x=!0),d!==void 0&&t.setVisible(d)&&(x=!0),g!==void 0&&t.setStyles(g)&&(x=!0),m!==void 0&&t.setExtendData(m)&&(x=!0,S=!0),f!==void 0&&t.setRegenerateFigures(f)&&(x=!0),_!==void 0&&t.setCreateTooltipDataSource(_)&&(x=!0),p!==void 0&&t.setDraw(p)&&(x=!0),v!==void 0&&(t.calc=v,S=!0),[x,S]}async addInstance(t,e,s){const{name:i}=t;let o=this._instances.get(e);if((o==null?void 0:o.has(i))??!1)return await Promise.reject(new Error("Duplicate indicators."));o===void 0&&(o=new Map,this._instances.set(e,o));const r=We(i),a=new r;return this._overrideInstance(a,t),s||o.clear(),o.set(i,a),await a.calcIndicator(this._chartStore.getDataList())}getInstances(t){return this._instances.get(t)??new Map}removeInstance(t,e){let s=!1;const i=this._instances.get(t);return i!==void 0&&(e!==void 0?i.has(e)&&(i.delete(e),s=!0):(i.clear(),s=!0),i.size===0&&this._instances.delete(t)),s}hasInstances(t){return this._instances.has(t)}async calcInstance(t,e){const s=[];if(t!==void 0)if(e!==void 0){const o=this._instances.get(e);if((o==null?void 0:o.has(t))??!1){const r=o==null?void 0:o.get(t);s.push(r.calcIndicator(this._chartStore.getDataList()))}}else this._instances.forEach(o=>{if(o.has(t)){const r=o==null?void 0:o.get(t);s.push(r.calcIndicator(this._chartStore.getDataList()))}});else this._instances.forEach(o=>{o.forEach(r=>{s.push(r.calcIndicator(this._chartStore.getDataList()))})});return(await Promise.all(s)).includes(!0)}getInstanceByPaneId(t,e){if(t!==void 0){const s=this._instances.get(t);return e!==void 0?(s==null?void 0:s.get(e))??null:s??null}return this._instances}setSeriesPrecision(t){this._instances.forEach(e=>{e.forEach(s=>{s.series===et.Price&&s.setPrecision(t.price,!0),s.series===et.Volume&&s.setPrecision(t.volume,!0)})})}async override(t,e){const{name:s}=t;let i=new Map;if(e!==null){const l=this._instances.get(e);l!==void 0&&i.set(e,l)}else i=this._instances;let o=!1;const r=[];i.forEach(l=>{const c=l.get(s);if(c!==void 0){const h=this._overrideInstance(c,t);h[1]?r.push(c.calcIndicator(this._chartStore.getDataList())):h[0]&&(o=!0)}});const a=await Promise.all(r);return[o,a.includes(!0)]}}class di{constructor(t){this._crosshair={},this._activeIcon=null,this._chartStore=t}setCrosshair(t,e){const s=this._chartStore.getDataList(),i=t??{};let o,r;i.x!==void 0?(o=this._chartStore.getTimeScaleStore().coordinateToDataIndex(i.x),o<0?r=0:o>s.length-1?r=s.length-1:r=o):(o=s.length-1,r=o);const a=s[r],l=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(o),c={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...i,realX:l,kLineData:a,realDataIndex:o,dataIndex:r},(c.x!==i.x||c.y!==i.y||c.paneId!==i.paneId)&&(a!==null&&this._chartStore.getChart().crosshairChange(this._crosshair),(e??!1)||this._chartStore.getChart().updatePane(A.Overlay))}recalculateCrosshair(t){this.setCrosshair(this._crosshair,t)}getCrosshair(){return this._crosshair}setActiveIcon(t){this._activeIcon=t??null}getActiveIcon(){return this._activeIcon}clear(){this.setCrosshair({},!0),this.setActiveIcon()}}var Gt=(n=>(n.Normal="normal",n.WeakMagnet="weak_magnet",n.StrongMagnet="strong_magnet",n))(Gt||{});function gi(){return["mouseClickEvent","mouseDoubleClickEvent","mouseRightClickEvent","tapEvent","doubleTapEvent","mouseDownEvent","touchStartEvent","mouseMoveEvent","touchMoveEvent"]}const Pe=1,Vt=-1,fi="overlay_",It="overlay_figure_",mi=Number.MAX_SAFE_INTEGER;class Qt{constructor(t){this.currentStep=Pe,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];const{mode:e,modeSensitivity:s,extendData:i,styles:o,name:r,totalStep:a,lock:l,visible:c,zLevel:h,needDefaultPointFigure:u,needDefaultXAxisFigure:d,needDefaultYAxisFigure:g,createPointFigures:m,createXAxisFigures:f,createYAxisFigures:_,performEventPressedMove:p,performEventMoveForDrawing:v,onDrawStart:x,onDrawing:S,onDrawEnd:y,onClick:C,onDoubleClick:b,onRightClick:w,onPressedMoveStart:E,onPressedMoving:T,onPressedMoveEnd:I,onMouseEnter:k,onMouseLeave:L,onRemoved:B,onSelected:M,onDeselected:P}=t;this.name=r,this.totalStep=a===void 0||a<2?1:a,this.lock=l??!1,this.visible=c??!0,this.zLevel=h??0,this.needDefaultPointFigure=u??!1,this.needDefaultXAxisFigure=d??!1,this.needDefaultYAxisFigure=g??!1,this.mode=e??"normal",this.modeSensitivity=s??8,this.extendData=i,this.styles=o??{},this.createPointFigures=m??null,this.createXAxisFigures=f??null,this.createYAxisFigures=_??null,this.performEventPressedMove=p??null,this.performEventMoveForDrawing=v??null,this.onDrawStart=x??null,this.onDrawing=S??null,this.onDrawEnd=y??null,this.onClick=C??null,this.onDoubleClick=b??null,this.onRightClick=w??null,this.onPressedMoveStart=E??null,this.onPressedMoving=T??null,this.onPressedMoveEnd=I??null,this.onMouseEnter=k??null,this.onMouseLeave=L??null,this.onRemoved=B??null,this.onSelected=M??null,this.onDeselected=P??null}setId(t){return this.id===void 0?(this.id=t,!0):!1}setGroupId(t){return this.groupId===void 0?(this.groupId=t,!0):!1}setDefaultZLevel(t){return this.defaultZLevel===void 0?(this.defaultZLevel=t,!0):!1}setPaneId(t){this.paneId=t}setExtendData(t){return t!==this.extendData?(this.extendData=t,!0):!1}setStyles(t){return t!==null?(at(this.styles,t),!0):!1}setPoints(t){if(t.length>0){let e;if(this.points=[...t],t.length>=this.totalStep-1?(this.currentStep=Vt,e=this.totalStep-1):(this.currentStep=t.length+1,e=t.length),this.performEventMoveForDrawing!==null)for(let s=0;s<e;s++)this.performEventMoveForDrawing({currentStep:s+2,mode:this.mode,points:this.points,performPointIndex:s,performPoint:this.points[s]});return this.currentStep===Vt&&this.performEventPressedMove!==null&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1}setLock(t){return this.lock!==t?(this.lock=t,!0):!1}setVisible(t){return this.visible!==t?(this.visible=t,!0):!1}resetZLevel(){this.zLevel=this.defaultZLevel}setZLevel(t){return this.zLevel!==t?(this.zLevel=t,!0):!1}setMode(t){return this.mode!==t?(this.mode=t,!0):!1}setModeSensitivity(t){return this.modeSensitivity!==t?(this.modeSensitivity=t,!0):!1}setOnDrawStartCallback(t){return this.onDrawStart!==t?(this.onDrawStart=t,!0):!1}setOnDrawingCallback(t){return this.onDrawing!==t?(this.onDrawing=t,!0):!1}setOnDrawEndCallback(t){return this.onDrawEnd!==t?(this.onDrawEnd=t,!0):!1}setOnClickCallback(t){return this.onClick!==t?(this.onClick=t,!0):!1}setOnDoubleClickCallback(t){return this.onDoubleClick!==t?(this.onDoubleClick=t,!0):!1}setOnRightClickCallback(t){return this.onRightClick!==t?(this.onRightClick=t,!0):!1}setOnPressedMoveStartCallback(t){return this.onPressedMoveStart!==t?(this.onPressedMoveStart=t,!0):!1}setOnPressedMovingCallback(t){return this.onPressedMoving!==t?(this.onPressedMoving=t,!0):!1}setOnPressedMoveEndCallback(t){return this.onPressedMoveEnd!==t?(this.onPressedMoveEnd=t,!0):!1}setOnMouseEnterCallback(t){return this.onMouseEnter!==t?(this.onMouseEnter=t,!0):!1}setOnMouseLeaveCallback(t){return this.onMouseLeave!==t?(this.onMouseLeave=t,!0):!1}setOnRemovedCallback(t){return this.onRemoved!==t?(this.onRemoved=t,!0):!1}setOnSelectedCallback(t){return this.onSelected!==t?(this.onSelected=t,!0):!1}setOnDeselectedCallback(t){return this.onDeselected!==t?(this.onDeselected=t,!0):!1}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=Vt:this.currentStep++}forceComplete(){this.currentStep=Vt}isDrawing(){return this.currentStep!==Vt}isStart(){return this.currentStep===Pe}eventMoveForDrawing(t){var i;const e=this.currentStep-1,s={};t.timestamp!==void 0&&(s.timestamp=t.timestamp),t.dataIndex!==void 0&&(s.dataIndex=t.dataIndex),t.value!==void 0&&(s.value=t.value),this.points[e]=s,(i=this.performEventMoveForDrawing)==null||i.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:e,performPoint:s})}eventPressedPointMove(t,e){var s;t.dataIndex!==void 0&&(this.points[e].dataIndex=t.dataIndex,this.points[e].timestamp=t.timestamp),t.value!==void 0&&(this.points[e].value=t.value),(s=this.performEventPressedMove)==null||s.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=Be(this.points)}eventPressedOtherMove(t,e){if(this._prevPressedPoint!==null){let s;t.dataIndex!==void 0&&this._prevPressedPoint.dataIndex!==void 0&&(s=t.dataIndex-this._prevPressedPoint.dataIndex);let i;t.value!==void 0&&this._prevPressedPoint.value!==void 0&&(i=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(o=>{o.dataIndex===void 0&&o.timestamp!==void 0&&(o.dataIndex=e.timestampToDataIndex(o.timestamp));const r={...o};return s!==void 0&&o.dataIndex!==void 0&&(r.dataIndex=o.dataIndex+s,r.timestamp=e.dataIndexToTimestamp(r.dataIndex)??void 0),i!==void 0&&o.value!==void 0&&(r.value=o.value+i),r})}}static extend(t){class e extends Qt{constructor(){super(t)}}return e}}const pi={name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t,overlay:e,precision:s,thousandsSeparator:i})=>{const o=e.points;if(n.length>0){const r=[],a=[],c=t.width;if(n.length>1&&o[0].value!==void 0&&o[1].value!==void 0){const h=[1,.786,.618,.5,.382,.236,0],u=n[0].y-n[1].y,d=o[0].value-o[1].value;h.forEach(g=>{const m=n[1].y+u*g,f=Y(((o[1].value??0)+d*g).toFixed(s.price),i);r.push({coordinates:[{x:0,y:m},{x:c,y:m}]}),a.push({x:0,y:m,text:`${f} (${(g*100).toFixed(1)}%)`,baseline:"bottom"})})}return[{type:"line",attrs:r},{type:"text",isCheckEvent:!1,attrs:a}]}return[]}},_i={name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>{const e={x:0,y:n[0].y};return n[1]!==void 0&&n[0].x<n[1].x&&(e.x=t.width),[{type:"line",attrs:{coordinates:[n[0],e]}}]},performEventPressedMove:({points:n,performPoint:t})=>{n[0].value=t.value,n[1].value=t.value},performEventMoveForDrawing:({currentStep:n,points:t,performPoint:e})=>{n===2&&(t[0].value=e.value)}},vi={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>{const t=[];return n.length===2&&t.push({coordinates:n}),[{type:"line",attrs:t}]},performEventPressedMove:({points:n,performPoint:t})=>{n[0].value=t.value,n[1].value=t.value},performEventMoveForDrawing:({currentStep:n,points:t,performPoint:e})=>{n===2&&(t[0].value=e.value)}},xi={name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>[{type:"line",attrs:{coordinates:[{x:0,y:n[0].y},{x:t.width,y:n[0].y}]}}]};class ge{constructor(){this._children=[],this._callbacks=new Map}registerEvent(t,e){return this._callbacks.set(t,e),this}onEvent(t,e,s){const i=this._callbacks.get(t);return i!==void 0&&this.checkEventOn(e)?i(e,s):!1}checkEventOn(t){for(const e of this._children)if(e.checkEventOn(t))return!0;return!1}dispatchEvent(t,e,s){const i=this._children.length-1;if(i>-1){for(let o=i;o>-1;o--)if(this._children[o].dispatchEvent(t,e,s))return!0}return this.onEvent(t,e,s)}addChild(t){return this._children.push(t),this}clear(){this._children=[]}}const W=2;class fe extends ge{constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){class e extends fe{checkEventOnImp(i,o,r){return t.checkEventOn(i,o,r)}drawImp(i,o,r){t.draw(i,o,r)}}return e}}function Ae(n,t){return Math.sqrt(Math.pow(n.x+t.x,2)+Math.pow(n.y+t.y,2))}function Si(n){const t=Ae(n[0],n[1]),e=Ae(n[1],n[2]),s=t+e,i=[n[2].x-n[0].x,n[2].y-n[0].y];return[{x:n[1].x-i[0]*.5*t/s,y:n[1].y-i[1]*.5*t/s},{x:n[1].x+i[0]*.5*t/s,y:n[1].y+i[1]*.5*t/s}]}function Ci(n,t){const e=t.coordinates;if(e.length>1)for(let s=1;s<e.length;s++){const i=e[s-1],o=e[s];if(i.x===o.x){if(Math.abs(i.y-n.y)+Math.abs(o.y-n.y)-Math.abs(i.y-o.y)<W+W&&Math.abs(n.x-i.x)<W)return!0}else{const r=me(i,o),a=ze(r,n),l=Math.abs(a-n.y);if(Math.abs(i.x-n.x)+Math.abs(o.x-n.x)-Math.abs(i.x-o.x)<W+W&&l*l/(r[0]*r[0]+1)<W*W)return!0}}return!1}function ze(n,t){return n!=null?t.x*n[0]+n[1]:t.y}function Ut(n,t,e){const s=me(n,t);return ze(s,e)}function me(n,t){const e=n.x-t.x;if(e!==0){const s=(n.y-t.y)/e,i=n.y-s*n.x;return[s,i]}return null}function yi(n,t,e){const{coordinates:s}=t,i=s.length;if(i>1){const{style:o=J.Solid,smooth:r,size:a=1,color:l="currentColor",dashedValue:c=[2,2]}=e;if(n.lineWidth=a,n.strokeStyle=l,o===J.Dashed?n.setLineDash(c):n.setLineDash([]),n.beginPath(),n.moveTo(s[0].x,s[0].y),r??!1){let h=[];for(let d=1;d<i-1;d++)h=h.concat(Si([s[d-1],s[d],s[d+1]]));n.quadraticCurveTo(h[0].x,h[0].y,s[1].x,s[1].y);let u=2;for(;u<i-1;u++)n.bezierCurveTo(h[(u-2)*2+1].x,h[(u-2)*2+1].y,h[(u-1)*2].x,h[(u-1)*2].y,s[u].x,s[u].y);n.quadraticCurveTo(h[(u-2)*2+1].x,h[(u-2)*2+1].y,s[u].x,s[u].y)}else for(let h=1;h<s.length;h++)n.lineTo(s[h].x,s[h].y);n.stroke(),n.closePath()}}const bi={name:"line",checkEventOn:Ci,draw:(n,t,e)=>{yi(n,t,e)}};function Xe(n,t,e){const s=e??0,i=[];if(n.length>1)if(n[0].x===n[1].x){const r=t.height;if(i.push({coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:r}]}),n.length>2){i.push({coordinates:[{x:n[2].x,y:0},{x:n[2].x,y:r}]});const a=n[0].x-n[2].x;for(let l=0;l<s;l++){const c=a*(l+1);i.push({coordinates:[{x:n[0].x+c,y:0},{x:n[0].x+c,y:r}]})}}}else{const r=t.width,a=me(n[0],n[1]),l=a[0],c=a[1];if(i.push({coordinates:[{x:0,y:0*l+c},{x:r,y:r*l+c}]}),n.length>2){const h=n[2].y-l*n[2].x;i.push({coordinates:[{x:0,y:0*l+h},{x:r,y:r*l+h}]});const u=c-h;for(let d=0;d<s;d++){const g=c+u*(d+1);i.push({coordinates:[{x:0,y:0*l+g},{x:r,y:r*l+g}]})}}}return i}const wi={name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>[{type:"line",attrs:Xe(n,t)}]},Ii={name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>[{type:"line",attrs:Xe(n,t,1)}]},Ei={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t,precision:e,overlay:s,thousandsSeparator:i})=>{const{value:o=0}=s.points[0];return[{type:"line",attrs:{coordinates:[n[0],{x:t.width,y:n[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:n[0].x,y:n[0].y,text:Y(o.toFixed(e.price),i),baseline:"bottom"}}]}};function Ti(n,t){if(n.length>1){let e;return n[0].x===n[1].x&&n[0].y!==n[1].y?n[0].y<n[1].y?e={x:n[0].x,y:t.height}:e={x:n[0].x,y:0}:n[0].x>n[1].x?e={x:0,y:Ut(n[0],n[1],{x:0,y:n[0].y})}:e={x:t.width,y:Ut(n[0],n[1],{x:t.width,y:n[0].y})},{coordinates:[n[0],e]}}return[]}const Mi={name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>[{type:"line",attrs:Ti(n,t)}]},Di={name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n}}]:[]},Pi={name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>n.length===2?n[0].x===n[1].x?[{type:"line",attrs:{coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:t.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Ut(n[0],n[1],{x:0,y:n[0].y})},{x:t.width,y:Ut(n[0],n[1],{x:t.width,y:n[0].y})}]}}]:[]},Ai={name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>{if(n.length===2){const e={x:n[0].x,y:0};return n[0].y<n[1].y&&(e.y=t.height),[{type:"line",attrs:{coordinates:[n[0],e]}}]}return[]},performEventPressedMove:({points:n,performPoint:t})=>{n[0].timestamp=t.timestamp,n[0].dataIndex=t.dataIndex,n[1].timestamp=t.timestamp,n[1].dataIndex=t.dataIndex},performEventMoveForDrawing:({currentStep:n,points:t,performPoint:e})=>{n===2&&(t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex)}},ki={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n})=>n.length===2?[{type:"line",attrs:{coordinates:n}}]:[],performEventPressedMove:({points:n,performPoint:t})=>{n[0].timestamp=t.timestamp,n[0].dataIndex=t.dataIndex,n[1].timestamp=t.timestamp,n[1].dataIndex=t.dataIndex},performEventMoveForDrawing:({currentStep:n,points:t,performPoint:e})=>{n===2&&(t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex)}},Fi={name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:n,bounding:t})=>[{type:"line",attrs:{coordinates:[{x:n[0].x,y:0},{x:n[0].x,y:t.height}]}}]},Ri={name:"simpleAnnotation",totalStep:2,styles:{text:{borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"},line:{style:J.Dashed}},createPointFigures:({overlay:n,coordinates:t})=>{let e;X(n.extendData)&&(Ot(n.extendData)?e=n.extendData(n):e=n.extendData??"");const s=t[0].x,i=t[0].y-6,o=i-50,r=o-5;return[{type:"line",attrs:{coordinates:[{x:s,y:i},{x:s,y:o}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:o},{x:s-4,y:r},{x:s+4,y:r}]},ignoreEvent:!0},{type:"text",attrs:{x:s,y:r,text:e??"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},Li={name:"simpleTag",totalStep:2,styles:{text:{borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"}},createPointFigures:({bounding:n,coordinates:t})=>({type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:n.width,y:t[0].y}]},ignoreEvent:!0}),createYAxisFigures:({overlay:n,coordinates:t,bounding:e,yAxis:s,precision:i})=>{const o=(s==null?void 0:s.isFromZero())??!1;let r,a;o?(r="left",a=0):(r="right",a=e.width);let l;return X(n.extendData)&&(Ot(n.extendData)?l=n.extendData(n):l=n.extendData??""),!X(l)&&n.points[0].value!==void 0&&(l=z(n.points[0].value,i.price)),{type:"text",attrs:{x:a,y:t[0].y,text:l??"",align:r,baseline:"middle"}}}},pe={},Bi=[pi,_i,vi,xi,wi,Ii,Ei,Mi,Di,Pi,Ai,ki,Fi,Ri,Li];Bi.forEach(n=>{pe[n.name]=Qt.extend(n)});function rn(n){pe[n.name]=Qt.extend(n)}function Vi(n){return pe[n]??null}function Ye(n){const t={width:0,height:0,left:0,right:0,top:0,bottom:0};return n!==void 0&&at(t,n),t}const D={MAIN:"main",XAXIS:"xAxis",YAXIS:"yAxis",SEPARATOR:"separator"};class He extends ge{constructor(t,e){super(),this._bounding=Ye(),this._pane=e,this._init(t)}_init(t){if(this._container=ct("div",this.getContainerStyle()),this.insertBefore()){const e=t.lastChild;e!==null?t.insertBefore(this._container,e):t.appendChild(this._container)}else t.appendChild(this._container);this.initDom(this._container)}setBounding(t){return at(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}update(t){this.updateImp(this._container,this._bounding,t??A.Drawer)}insertBefore(){return!1}}function Ni(n,t){let e=0;return function(){const s=Date.now();s-e>(t??20)&&(n.apply(this,arguments),e=s)}}const Dt=7;class Oi extends He{constructor(t,e){super(t,e),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._currentPaneHeight=0,this._pressedMouseMoveEvent=Ni(this._pressedTouchMouseMoveEvent,20),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return D.SEPARATOR}checkEventOn(){return!0}_mouseDownEvent(t){var s;this._dragFlag=!0,this._dragStartY=t.pageY;const e=this.getPane();return this._topPaneHeight=((s=e.getTopPane())==null?void 0:s.getBounding().height)??0,this._currentPaneHeight=e.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,s=this.getPane(),i=s.getTopPane(),o=e<0;if(i!==null&&s.getOptions().dragEnabled){let r,a,l,c;o?(r=i,a=s,l=this._topPaneHeight,c=this._currentPaneHeight):(r=s,a=i,l=this._currentPaneHeight,c=this._topPaneHeight);const h=r.getOptions().minHeight;if(l>h){const u=Math.max(l-Math.abs(e),h),d=l-u;r.setBounding({height:u}),a.setBounding({height:c+d});const g=s.getChart();g.getChartStore().getActionStore().execute(lt.OnPaneDrag,{paneId:s.getId}),g.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getOptions().dragEnabled){const s=t.getChart().getStyles().separator;return this._moveDom.style.background=s.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this._moveDom.style.background="",!0)}getContainerStyle(){return{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}}insertBefore(){return!0}initDom(t){this._moveDom=ct("div",{width:"100%",height:`${Dt}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"}),t.appendChild(this._moveDom)}updateImp(t,e,s){if(s===A.All||s===A.Separator){const i=this.getPane().getChart().getStyles().separator;this._moveDom.style.top=`${-Math.floor((Dt-i.size)/2)}px`,this._moveDom.style.height=`${Dt}px`;const o=i.fill;t.style.backgroundColor=i.color,t.style.height=`${i.size}px`,t.style.marginLeft=`${o?0:e.left}px`,t.style.width=o?"100%":`${e.width}px`}}getImage(){const t=this.getPane().getChart().getStyles().separator,e=this.getContainer().offsetWidth,s=t.size,i=ct("canvas",{width:`${e}px`,height:`${s}px`,boxSizing:"border-box"}),o=i.getContext("2d"),r=yt(i);return i.width=e*r,i.height=s*r,o.scale(r,r),o.fillStyle=t.color,o.fillRect(this.getBounding().left,0,e,s),i}}const Wi=30,zi=100,F={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",XAXIS:"xaxis_pane"};class $e{constructor(t,e,s,i,o){this._yAxisWidget=null,this._separatorWidget=null,this._axis=this.createAxisComponent(),this._bounding=Ye(),this._options={minHeight:Wi,dragEnabled:!0,gap:{top:.2,bottom:.1},axisOptions:{scrollZoomEnabled:!0}},this._chart=e,this._id=s,this._topPane=i??null,this._bottomPane=o??null,this._init(t)}_init(t){this._container=t,this._seriesContainer=ct("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._separatorWidget=this.createSeparatorWidget(t);const e=t.lastChild;e!==null?t.insertBefore(this._seriesContainer,e):t.appendChild(this._seriesContainer),this._mainWidget=this.createMainWidget(this._seriesContainer),this._yAxisWidget=this.createYAxisWidget(this._seriesContainer)}getContainer(){return this._seriesContainer}getId(){return this._id}setOptions(t){var i,o;at(this._options,t);let e,s;return this.getId()===F.XAXIS?(e=this.getMainWidget().getContainer(),s="ew-resize"):(e=(i=this.getYAxisWidget())==null?void 0:i.getContainer(),s="ns-resize"),((o=t.axisOptions)==null?void 0:o.scrollZoomEnabled)??!0?e.style.cursor=s:e.style.cursor="default",this}getOptions(){return this._options}getChart(){return this._chart}getAxisComponent(){return this._axis}setBounding(t,e,s){var r,a,l;at(this._bounding,t);let i=0;if(this._separatorWidget!==null){i=this._chart.getStyles().separator.size;const c={...t,height:Dt};t.top!==void 0&&(c.top=t.top-Math.floor((Dt-i)/2)),this._separatorWidget.setBounding(c)}const o={};return t.height!==void 0&&(o.height=t.height-i),t.top!==void 0&&(o.top=t.top+i),this._mainWidget.setBounding(o),(r=this._yAxisWidget)==null||r.setBounding(o),e!==void 0&&(this._mainWidget.setBounding(e),(a=this._separatorWidget)==null||a.setBounding(e)),s!==void 0&&((l=this._yAxisWidget)==null||l.setBounding(s)),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getBounding(){return this._bounding}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}getSeparatorWidget(){return this._separatorWidget}update(t){var i,o;this._bounding.width!==this._seriesContainer.offsetWidth&&(this._seriesContainer.style.width=`${this._bounding.width}px`);const e=this._mainWidget.getBounding().height;e!==this._seriesContainer.offsetHeight&&(this._seriesContainer.style.height=`${e}px`);const s=t??A.Drawer;this._mainWidget.update(s),(i=this._yAxisWidget)==null||i.update(s),(o=this._separatorWidget)==null||o.update(s)}getImage(t){const{width:e,height:s}=this._bounding,i=ct("canvas",{width:`${e}px`,height:`${s}px`,boxSizing:"border-box"}),o=i.getContext("2d"),r=yt(i);i.width=e*r,i.height=s*r,o.scale(r,r);let a=0;if(this._separatorWidget!=null){const c=this.getChart().getStyles().separator.size;a=c,o.drawImage(this._separatorWidget.getImage(),0,0,e,c)}const l=this._mainWidget.getBounding();if(o.drawImage(this._mainWidget.getImage(t),l.left,a,l.width,l.height),this._yAxisWidget!==null){const c=this._yAxisWidget.getBounding();o.drawImage(this._yAxisWidget.getImage(t),c.left,a,c.width,c.height)}return i}destroy(){this._container.removeChild(this._seriesContainer),this._separatorWidget!==null&&this._container.removeChild(this._separatorWidget.getContainer())}createSeparatorWidget(t){return null}createYAxisWidget(t){return null}}var G=(n=>(n[n.None=0]="None",n[n.Point=1]="Point",n[n.Other=2]="Other",n))(G||{});class Xi{constructor(t){this._instances=new Map,this._counter=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:0,figureKey:"",figureIndex:-1,attrsIndex:-1},this._chartStore=t}_overrideInstance(t,e){const{id:s,groupId:i,points:o,styles:r,lock:a,visible:l,zLevel:c,mode:h,modeSensitivity:u,extendData:d,onDrawStart:g,onDrawing:m,onDrawEnd:f,onClick:_,onDoubleClick:p,onRightClick:v,onPressedMoveStart:x,onPressedMoving:S,onPressedMoveEnd:y,onMouseEnter:C,onMouseLeave:b,onRemoved:w,onSelected:E,onDeselected:T}=e;let I=!1,k=!1;return s!==void 0&&t.setId(s),i!==void 0&&t.setGroupId(i),o!==void 0&&t.setPoints(o)&&(I=!0),r!==void 0&&t.setStyles(r)&&(I=!0),a!==void 0&&t.setLock(a),l!==void 0&&t.setVisible(l)&&(I=!0),c!==void 0&&t.setZLevel(c)&&(I=!0,k=!0),h!==void 0&&t.setMode(h),u!==void 0&&t.setModeSensitivity(u),d!==void 0&&t.setExtendData(d)&&(I=!0),g!==void 0&&t.setOnDrawStartCallback(g),m!==void 0&&t.setOnDrawingCallback(m),f!==void 0&&t.setOnDrawEndCallback(f),_!==void 0&&t.setOnClickCallback(_),p!==void 0&&t.setOnDoubleClickCallback(p),v!==void 0&&t.setOnRightClickCallback(v),x!==void 0&&t.setOnPressedMoveStartCallback(x),S!==void 0&&t.setOnPressedMovingCallback(S),y!==void 0&&t.setOnPressedMoveEndCallback(y),C!==void 0&&t.setOnMouseEnterCallback(C),b!==void 0&&t.setOnMouseLeaveCallback(b),w!==void 0&&t.setOnRemovedCallback(w),E!==void 0&&t.setOnSelectedCallback(E),T!==void 0&&t.setOnDeselectedCallback(T),[I,k]}getInstanceById(t){for(const e of this._instances){const i=e[1].find(o=>o.id===t);if(i!==void 0)return i}return this._progressInstanceInfo!==null&&this._progressInstanceInfo.instance.id===t?this._progressInstanceInfo.instance:null}_sort(t){var e;t!==void 0?(e=this._instances.get(t))==null||e.sort((s,i)=>s.defaultZLevel-i.defaultZLevel).sort((s,i)=>s.zLevel-i.zLevel):this._instances.forEach(s=>{s.sort((i,o)=>i.defaultZLevel-o.defaultZLevel).sort((i,o)=>i.zLevel-o.zLevel)})}addInstances(t,e,s){const i=t.map(o=>{var a,l;const r=o.id??Ne(fi);if(this.getInstanceById(r)===null){const c=Vi(o.name);if(c!==null){const h=new c,u=(this._counter.get(e)??0)+1;this._counter.set(e,u),h.setDefaultZLevel(u),h.setPaneId(e);const d=o.groupId??r;return o.id=r,o.groupId=d,this._overrideInstance(h,o),h.isDrawing()?this._progressInstanceInfo={paneId:e,instance:h,appointPaneFlag:s}:(this._instances.has(e)||this._instances.set(e,[]),(a=this._instances.get(e))==null||a.push(h)),h.isStart()&&((l=h.onDrawStart)==null||l.call(h,{overlay:h})),r}}return null});return i.some(o=>o!==null)&&(this._sort(),this._chartStore.getChart().updatePane(A.Overlay,e)),i}getProgressInstanceInfo(){return this._progressInstanceInfo}progressInstanceComplete(){var t;if(this._progressInstanceInfo!==null){const{instance:e,paneId:s}=this._progressInstanceInfo;e.isDrawing()||(this._instances.has(s)||this._instances.set(s,[]),(t=this._instances.get(s))==null||t.push(e),this._sort(s),this._progressInstanceInfo=null)}}updateProgressInstanceInfo(t,e){this._progressInstanceInfo!==null&&(e!==void 0&&e&&(this._progressInstanceInfo.appointPaneFlag=e),this._progressInstanceInfo.paneId=t,this._progressInstanceInfo.instance.setPaneId(t))}getInstances(t){if(t===void 0){let e=[];return this._instances.forEach(s=>{e=e.concat(s)}),e}return this._instances.get(t)??[]}override(t){const{id:e,groupId:s,name:i}=t;let o=!1,r=!1;const a=l=>{const c=this._overrideInstance(l,t);c[0]&&(o=!0),c[1]&&(r=!0)};if(e!==void 0){const l=this.getInstanceById(e);l!==null&&a(l)}else if(this._instances.forEach(l=>{l.forEach(c=>{(i!==void 0&&c.name===i||s!==void 0&&c.groupId===s||i===void 0&&s===void 0)&&a(c)})}),this._progressInstanceInfo!==null){const l=this._progressInstanceInfo.instance;(i!==void 0&&l.name===i||s!==void 0&&l.groupId===s||i===void 0&&s===void 0)&&a(l)}r&&this._sort(),o&&this._chartStore.getChart().updatePane(A.Overlay)}removeInstance(t){var i;const e=(o,r)=>{if(o.id!==void 0){if(r.id!==o.id)return!1}else if(o.groupId!==void 0){if(r.groupId!==o.groupId)return!1}else if(o.name!==void 0&&r.name!==o.name)return!1;return!0},s=[];if(this._progressInstanceInfo!==null){const{instance:o}=this._progressInstanceInfo;(t===void 0||t!==void 0&&e(t,o))&&(s.push(this._progressInstanceInfo.paneId),(i=o.onRemoved)==null||i.call(o,{overlay:o}),this._progressInstanceInfo=null)}if(t!==void 0){const o=new Map;for(const r of this._instances){const l=r[1].filter(c=>{var h;return e(t,c)?(s.includes(r[0])||s.push(r[0]),(h=c.onRemoved)==null||h.call(c,{overlay:c}),!1):!0});l.length>0&&o.set(r[0],l)}this._instances=o}else this._instances.forEach((o,r)=>{s.push(r),o.forEach(a=>{var l;(l=a.onRemoved)==null||l.call(a,{overlay:a})})}),this._instances.clear();if(s.length>0){const o=this._chartStore.getChart();s.forEach(r=>{o.updatePane(A.Overlay,r)}),o.updatePane(A.Overlay,F.XAXIS)}}setPressedInstanceInfo(t){this._pressedInstanceInfo=t}getPressedInstanceInfo(){return this._pressedInstanceInfo}setHoverInstanceInfo(t,e){var a,l;const{instance:s,figureType:i,figureKey:o,figureIndex:r}=this._hoverInstanceInfo;if(((s==null?void 0:s.id)!==((a=t.instance)==null?void 0:a.id)||i!==t.figureType||r!==t.figureIndex)&&(this._hoverInstanceInfo=t,(s==null?void 0:s.id)!==((l=t.instance)==null?void 0:l.id))){let c=!1,h=!1;s!==null&&(h=!0,s.resetZLevel(),Ot(s.onMouseLeave)&&(s.onMouseLeave({overlay:s,figureKey:o,figureIndex:r,...e}),c=!0)),t.instance!==null&&(h=!0,t.instance.setZLevel(mi),Ot(t.instance.onMouseEnter)&&(t.instance.onMouseEnter({overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex,...e}),c=!0)),h&&this._sort(),c||this._chartStore.getChart().updatePane(A.Overlay)}}getHoverInstanceInfo(){return this._hoverInstanceInfo}setClickInstanceInfo(t,e){var l,c,h,u,d,g,m,f;const{paneId:s,instance:i,figureType:o,figureKey:r,figureIndex:a}=this._clickInstanceInfo;if((((l=t.instance)==null?void 0:l.isDrawing())??!1)||(h=(c=t.instance)==null?void 0:c.onClick)==null||h.call(c,{overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex,...e}),((i==null?void 0:i.id)!==((u=t.instance)==null?void 0:u.id)||o!==t.figureType||a!==t.figureIndex)&&(this._clickInstanceInfo=t,(i==null?void 0:i.id)!==((d=t.instance)==null?void 0:d.id))){(g=i==null?void 0:i.onDeselected)==null||g.call(i,{overlay:i,figureKey:r,figureIndex:a,...e}),(f=(m=t.instance)==null?void 0:m.onSelected)==null||f.call(m,{overlay:t.instance,figureKey:t.figureKey,figureIndex:t.figureIndex,...e});const _=this._chartStore.getChart();_.updatePane(A.Overlay,t.paneId),s!==t.paneId&&_.updatePane(A.Overlay,s),_.updatePane(A.Overlay,F.XAXIS)}}getClickInstanceInfo(){return this._clickInstanceInfo}isEmpty(){return this._instances.size===0&&this._progressInstanceInfo===null}isDrawing(){var t;return this._progressInstanceInfo!==null&&(((t=this._progressInstanceInfo)==null?void 0:t.instance.isDrawing())??!1)}}class Yi{constructor(){this._actions=new Map}execute(t,e){var s;(s=this._actions.get(t))==null||s.execute(e)}subscribe(t,e){var s;this._actions.has(t)||this._actions.set(t,new Ps),(s=this._actions.get(t))==null||s.subscribe(e)}unsubscribe(t,e){const s=this._actions.get(t);s!==void 0&&(s.unsubscribe(e),s.isEmpty()&&this._actions.delete(t))}has(t){const e=this._actions.get(t);return e!==void 0&&!e.isEmpty()}}const Hi={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},$i={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},Ze={light:Hi,dark:$i};function an(n,t){Ze[n]=t}function Ge(n){return Ze[n]??null}class Zi{constructor(t,e){this._styles=Ts(),this._customApi=Ms(),this._locale=Ds,this._precision={price:2,volume:0},this._thousandsSeparator=",",this._dataList=[],this._timeScaleStore=new Ls(this),this._indicatorStore=new ui(this),this._overlayStore=new Xi(this),this._tooltipStore=new di(this),this._actionStore=new Yi,this._visibleDataList=[],this._chart=t,this.setOptions(e)}adjustVisibleDataList(){this._visibleDataList=[];const{from:t,to:e}=this._timeScaleStore.getVisibleRange();for(let s=t;s<e;s++){const i=this._dataList[s],o=this._timeScaleStore.dataIndexToCoordinate(s);this._visibleDataList.push({dataIndex:s,x:o,data:i})}}setOptions(t){if(t!==void 0){const{locale:e,timezone:s,styles:i,customApi:o}=t;e!==void 0&&(this._locale=e),s!==void 0&&this._timeScaleStore.setTimezone(s),i!==void 0&&(ot(i)?at(this._styles,Ge(i)):at(this._styles,i)),o!==void 0&&at(this._customApi,o),t.thousandsSeparator!==void 0&&(this._thousandsSeparator=t.thousandsSeparator)}return this}getStyles(){return this._styles}getLocale(){return this._locale}getCustomApi(){return this._customApi}getThousandsSeparator(){return this._thousandsSeparator}getPrecision(){return this._precision}setPrecision(t){return this._precision=t,this._indicatorStore.setSeriesPrecision(t),this}getDataList(){return this._dataList}getVisibleDataList(){return this._visibleDataList}addData(t,e,s){if(nt(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(s??!0);const i=this._dataList.length===0;this._dataList=t.concat(this._dataList),i&&this._timeScaleStore.resetOffsetRightDistance(),this._timeScaleStore.adjustVisibleRange()}else{const i=this._dataList.length;if(e>=i){this._dataList.push(t);let o=this._timeScaleStore.getOffsetRightBarCount();o<0&&this._timeScaleStore.setOffsetRightBarCount(--o),this._timeScaleStore.adjustVisibleRange()}else this._dataList[e]=t,this.adjustVisibleDataList()}this._tooltipStore.recalculateCrosshair(!0)}clear(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear(),this._tooltipStore.clear()}getTimeScaleStore(){return this._timeScaleStore}getIndicatorStore(){return this._indicatorStore}getOverlayStore(){return this._overlayStore}getTooltipStore(){return this._tooltipStore}getActionStore(){return this._actionStore}getChart(){return this._chart}}function ce(n){return window.requestAnimationFrame==null?window.setTimeout(n,20):window.requestAnimationFrame(n)}function qt(n){window.cancelAnimationFrame==null&&window.clearTimeout(n),window.cancelAnimationFrame(n)}const Et=-1;class _e extends He{constructor(){super(...arguments),this._mainRequestAnimationId=Et,this._overlayRequestAnimationId=Et}getContainerStyle(){return{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}}initDom(t){this._mainCanvas=ct("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._mainCtx=this._mainCanvas.getContext("2d"),this._overlayCanvas=ct("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._overlayCtx=this._overlayCanvas.getContext("2d"),t.appendChild(this._mainCanvas),t.appendChild(this._overlayCanvas)}_optimalUpdateMain(t,e){this._mainRequestAnimationId!==Et&&(qt(this._mainRequestAnimationId),this._mainRequestAnimationId=Et),this._mainRequestAnimationId=ce(()=>{if(t!==this._mainCanvas.offsetWidth||e!==this._mainCanvas.offsetHeight){this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight);const s=yt(this._mainCanvas),i=Math.floor(t*s),o=Math.floor(e*s);this._mainCanvas.style.width=`${t}px`,this._mainCanvas.style.height=`${e}px`,this._mainCanvas.width=i,this._mainCanvas.height=o,this._mainCtx.scale(s,s)}else this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight);this.updateMain(this._mainCtx)})}_optimalUpdateOverlay(t,e){this._overlayRequestAnimationId!==Et&&(qt(this._overlayRequestAnimationId),this._overlayRequestAnimationId=Et),this._overlayRequestAnimationId=ce(()=>{if(t!==this._overlayCanvas.offsetWidth||e!==this._overlayCanvas.offsetHeight){this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);const s=yt(this._overlayCanvas),i=Math.floor(t*s),o=Math.floor(e*s);this._overlayCanvas.style.width=`${t}px`,this._overlayCanvas.style.height=`${e}px`,this._overlayCanvas.width=i,this._overlayCanvas.height=o,this._overlayCtx.scale(s,s)}else this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);this.updateOverlay(this._overlayCtx)})}updateImp(t,e,s){const{width:i,height:o,left:r}=e;t.style.left=`${r}px`;let a=s;switch((i!==t.offsetWidth||o!==t.offsetHeight)&&(t.style.width=`${i}px`,t.style.height=`${o}px`,a=A.Drawer),a){case A.Main:{this._optimalUpdateMain(i,o);break}case A.Overlay:{this._optimalUpdateOverlay(i,o);break}case A.Drawer:case A.All:{this._optimalUpdateMain(i,o),this._optimalUpdateOverlay(i,o);break}}}getImage(t){const{width:e,height:s}=this.getBounding(),i=ct("canvas",{width:`${e}px`,height:`${s}px`,boxSizing:"border-box"}),o=i.getContext("2d"),r=yt(i);return i.width=e*r,i.height=s*r,o.scale(r,r),o.drawImage(this._mainCanvas,0,0,e,s),t&&o.drawImage(this._overlayCanvas,0,0,e,s),i}}function Gi(n,t){const e=n.x-t.x,s=n.y-t.y,i=t.r;return!(e*e+s*s>i*i)}function ji(n,t,e){const{x:s,y:i,r:o}=t,{style:r=R.Fill,color:a="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:h=J.Solid,borderDashedValue:u=[2,2]}=e;(r===R.Fill||e.style===R.StrokeFill)&&(n.fillStyle=a,n.beginPath(),n.arc(s,i,o,0,Math.PI*2),n.closePath(),n.fill()),(r===R.Stroke||e.style===R.StrokeFill)&&(n.strokeStyle=c,n.lineWidth=l,h===J.Dashed?n.setLineDash(u):n.setLineDash([]),n.beginPath(),n.arc(s,i,o,0,Math.PI*2),n.closePath(),n.stroke())}const Ui={name:"circle",checkEventOn:Gi,draw:(n,t,e)=>{ji(n,t,e)}};function qi(n,t){let e=!1;const s=t.coordinates;for(let i=0,o=s.length-1;i<s.length;o=i++)s[i].y>n.y!=s[o].y>n.y&&n.x<(s[o].x-s[i].x)*(n.y-s[i].y)/(s[o].y-s[i].y)+s[i].x&&(e=!e);return e}function Ki(n,t,e){const{coordinates:s}=t,{style:i=R.Fill,color:o="currentColor",borderSize:r=1,borderColor:a="currentColor",borderStyle:l=J.Solid,borderDashedValue:c=[2,2]}=e;if(i===R.Fill||e.style===R.StrokeFill){n.fillStyle=o,n.beginPath(),n.moveTo(s[0].x,s[0].y);for(let h=1;h<s.length;h++)n.lineTo(s[h].x,s[h].y);n.closePath(),n.fill()}if(i===R.Stroke||e.style===R.StrokeFill){n.strokeStyle=a,n.lineWidth=r,l===J.Dashed?n.setLineDash(c):n.setLineDash([]),n.beginPath(),n.moveTo(s[0].x,s[0].y);for(let h=1;h<s.length;h++)n.lineTo(s[h].x,s[h].y);n.closePath(),n.stroke()}}const Ji={name:"polygon",checkEventOn:qi,draw:(n,t,e)=>{Ki(n,t,e)}};function ke(n){return n==="transparent"}function Qi(n,t){let e=t.x,s=t.width;s<W*2&&(e-=W,s=W*2);let i=t.y,o=t.height;return o<W*2&&(i-=W,o=W*2),n.x>=e&&n.x<=e+s&&n.y>=i&&n.y<=i+o}function je(n,t,e){const{x:s,y:i,width:o,height:r}=t,{style:a=R.Fill,color:l="transparent",borderSize:c=1,borderColor:h="transparent",borderStyle:u=J.Solid,borderRadius:d=0,borderDashedValue:g=[2,2]}=e;if(a===R.Fill||e.style===R.StrokeFill){let m=!0;ot(l)&&(m=!ke(l)),m&&(n.fillStyle=l,n.beginPath(),n.moveTo(s+d,i),n.arcTo(s+o,i,s+o,i+r,d),n.arcTo(s+o,i+r,s,i+r,d),n.arcTo(s,i+r,s,i,d),n.arcTo(s,i,s+o,i,d),n.closePath(),n.fill())}(a===R.Stroke||e.style===R.StrokeFill)&&!ke(h)&&c>=0&&(n.strokeStyle=h,n.lineWidth=c,u===J.Dashed?n.setLineDash(g):n.setLineDash([]),n.beginPath(),n.moveTo(s+d,i),n.arcTo(s+o,i,s+o,i+r,d),n.arcTo(s+o,i+r,s,i+r,d),n.arcTo(s,i+r,s,i,d),n.arcTo(s,i,s+o,i,d),n.closePath(),n.stroke())}const to={name:"rect",checkEventOn:Qi,draw:(n,t,e)=>{je(n,t,e)}};function Ue(n,t){const{size:e=12,paddingLeft:s=0,paddingTop:i=0,paddingRight:o=0,paddingBottom:r=0,weight:a="normal",family:l}=t,{x:c,y:h,text:u,align:d="left",baseline:g="top",width:m,height:f}=n,_=m??s+jt(u,e,a,l)+o,p=f??i+e+r;let v;switch(d){case"left":case"start":{v=c;break}case"right":case"end":{v=c-_;break}default:{v=c-_/2;break}}let x;switch(g){case"top":case"hanging":{x=h;break}case"bottom":case"ideographic":case"alphabetic":{x=h-p;break}default:{x=h-p/2;break}}return{x:v,y:x,width:_,height:p}}function eo(n,t,e){const{x:s,y:i,width:o,height:r}=Ue(t,e);return n.x>=s&&n.x<=s+o&&n.y>=i&&n.y<=i+r}function so(n,t,e){const{text:s}=t,{color:i="currentColor",size:o=12,family:r,weight:a,paddingLeft:l=0,paddingTop:c=0,paddingRight:h=0}=e,u=Ue(t,e);je(n,u,{...e,color:e.backgroundColor}),n.textAlign="left",n.textBaseline="top",n.font=bt(o,a,r),n.fillStyle=i,n.fillText(s,u.x+l,u.y+c,u.width-l-h)}const qe={name:"text",checkEventOn:(n,t,e)=>eo(n,t,e),draw:(n,t,e)=>{so(n,t,e)}},io=qe;function oo(n,t){const e=n.x-t.x,s=n.y-t.y;return Math.sqrt(e*e+s*s)}function no(n,t){if(Math.abs(oo(n,t)-t.r)<W){const{r:e,startAngle:s,endAngle:i}=t,o=e*Math.cos(s)+t.x,r=e*Math.sin(s)+t.y,a=e*Math.cos(i)+t.x,l=e*Math.sin(i)+t.y;return n.x<=Math.max(o,a)+W&&n.x>=Math.min(o,a)-W&&n.y<=Math.max(r,l)+W&&n.y>=Math.min(r,l)-W}return!1}function ro(n,t,e){const{x:s,y:i,r:o,startAngle:r,endAngle:a}=t,{style:l=J.Solid,size:c=1,color:h="currentColor",dashedValue:u=[2,2]}=e;n.lineWidth=c,n.strokeStyle=h,l===J.Dashed?n.setLineDash(u):n.setLineDash([]),n.beginPath(),n.arc(s,i,o,r,a),n.stroke(),n.closePath()}const ao={name:"arc",checkEventOn:no,draw:(n,t,e)=>{ro(n,t,e)}},Ke={},lo=[Ui,bi,Ji,to,qe,io,ao];lo.forEach(n=>{Ke[n.name]=fe.extend(n)});function co(n){return Ke[n]??null}class ht extends ge{constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e,s,i){const o=co(t);if(o!==null){const r=new o({name:t,attrs:e,styles:s});if(i!==void 0){for(const a in i)i.hasOwnProperty(a)&&r.registerEvent(a,i[a]);this.addChild(r)}return r}return null}draw(t){this.clear(),this.drawImp(t)}}class ho extends ht{drawImp(t){var l;const e=this.getWidget(),s=this.getWidget().getPane(),i=s.getChart(),o=e.getBounding(),r=i.getStyles().grid;if(r.show){t.save(),t.globalCompositeOperation="destination-over";const c=r.horizontal;c.show&&s.getAxisComponent().getTicks().forEach(m=>{var f;(f=this.createFigure("line",{coordinates:[{x:0,y:m.coord},{x:o.width,y:m.coord}]},c))==null||f.draw(t)});const u=r.vertical;u.show&&((l=i.getPaneById(F.XAXIS))==null?void 0:l.getAxisComponent()).getTicks().forEach(m=>{var f;(f=this.createFigure("line",{coordinates:[{x:m.coord,y:0},{x:m.coord,y:o.height}]},u))==null||f.draw(t)}),t.restore()}}}class ve extends ht{eachChildren(t){const s=this.getWidget().getPane().getChart().getChartStore(),i=s.getVisibleDataList(),o=s.getTimeScaleStore().getBarSpace();i.forEach((r,a)=>{t(r,o,a)})}}class Je extends ve{constructor(){super(...arguments),this._boundCandleBarClickEvent=t=>()=>(this.getWidget().getPane().getChart().getChartStore().getActionStore().execute(lt.OnCandleBarClick,t),!1)}drawImp(t){const e=this.getWidget().getPane(),s=e.getId()===F.CANDLE,i=e.getChart().getChartStore(),o=this.getCandleBarOptions(i);if(o!==null){const r=e.getAxisComponent();this.eachChildren((a,l)=>{this._drawCandleBar(t,r,a,l,o,s)})}}getCandleBarOptions(t){const e=t.getStyles().candle;return{type:e.type,styles:e.bar}}_drawCandleBar(t,e,s,i,o,r){const{data:a,x:l}=s,{open:c,high:h,low:u,close:d}=a,{halfGapBar:g,gapBar:m}=i,{type:f,styles:_}=o;let p,v,x;d>c?(p=_.upColor,v=_.upBorderColor,x=_.upWickColor):d<c?(p=_.downColor,v=_.downBorderColor,x=_.downWickColor):(p=_.noChangeColor,v=_.noChangeBorderColor,x=_.noChangeWickColor);const S=e.convertToPixel(c),y=e.convertToPixel(d),C=[S,y,e.convertToPixel(h),e.convertToPixel(u)];C.sort((E,T)=>E-T);const b=Math.max(1,C[2]-C[1]);let w=[];f!==pt.Ohlc?(w.push({name:"rect",attrs:{x:l-.5,y:C[0],width:1,height:C[1]-C[0]},styles:{color:x}}),f===pt.CandleStroke||f===pt.CandleUpStroke&&c<d||f===pt.CandleDownStroke&&c>d?w.push({name:"rect",attrs:{x:l-g+.5,y:C[1],width:m-1,height:b},styles:{style:R.Stroke,borderColor:v}}):w.push({name:"rect",attrs:{x:l-g+.5,y:C[1],width:m-1,height:b},styles:{style:R.StrokeFill,color:p,borderColor:v}}),w.push({name:"rect",attrs:{x:l-.5,y:C[2],width:1,height:C[3]-C[2]},styles:{color:x}})):w=[{name:"rect",attrs:{x:l-.5,y:C[0],width:1,height:C[3]-C[0]},styles:{color:p}},{name:"rect",attrs:{x:l-g,y:S,width:g,height:1},styles:{color:p}},{name:"rect",attrs:{x:l,y,width:g,height:1},styles:{color:p}}],w.forEach(({attrs:E,styles:T})=>{var k;let I;r&&(I={mouseClickEvent:this._boundCandleBarClickEvent(s)}),(k=this.createFigure("rect",E,T,I))==null||k.draw(t)})}}class uo extends Je{getCandleBarOptions(t){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const i=t.getIndicatorStore().getInstances(e.getId());for(const o of i){const r=o[1];if(r.shouldOhlc&&r.visible){const a=r.styles,l=t.getStyles().indicator,c=N(a,"ohlc.upColor",l.ohlc.upColor),h=N(a,"ohlc.downColor",l.ohlc.downColor),u=N(a,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:pt.Ohlc,styles:{upColor:c,downColor:h,noChangeColor:u,upBorderColor:c,downBorderColor:h,noChangeBorderColor:u,upWickColor:c,downWickColor:h,noChangeWickColor:u}}}}}return null}drawImp(t){var m;super.drawImp(t);const e=this.getWidget(),s=e.getPane(),i=s.getChart(),o=e.getBounding(),r=(m=i.getPaneById(F.XAXIS))==null?void 0:m.getAxisComponent(),a=s.getAxisComponent(),l=i.getChartStore(),c=l.getDataList(),h=l.getTimeScaleStore(),u=h.getVisibleRange(),d=l.getIndicatorStore().getInstances(s.getId()),g=l.getStyles().indicator;d.forEach(f=>{if(f.visible){let _=!1;if(f.draw!==null&&(t.save(),_=f.draw({ctx:t,kLineDataList:c,indicator:f,visibleRange:u,bounding:o,barSpace:h.getBarSpace(),defaultStyles:g,xAxis:r,yAxis:a})??!1,t.restore()),!_){const p=f.result;this.eachChildren((v,x)=>{const{halfGapBar:S,gapBar:y}=x,{dataIndex:C,x:b}=v,w=r.convertToPixel(C-1),E=r.convertToPixel(C+1),T=p[C-1]??{},I=p[C]??{},k=p[C+1]??{},L={x:w},B={x:b},M={x:E};f.figures.forEach(({key:P})=>{L[P]=a.convertToPixel(T[P]),B[P]=a.convertToPixel(I[P]),M[P]=a.convertToPixel(k[P])}),ue(c,f,C,g,(P,j)=>{var st,Q;if(X(I[P.key])){const U=B[P.key];let O=(st=P.attrs)==null?void 0:st.call(P,{coordinate:{prev:L,current:B,next:M},bounding:o,barSpace:x,xAxis:r,yAxis:a});if(!X(O))switch(P.type){case"circle":{O={x:b,y:U,r:S};break}case"rect":case"bar":{const K=P.baseValue??a.getExtremum().min,V=a.convertToPixel(K);let ut=Math.abs(V-U);K!==I[P.key]&&(ut=Math.max(1,ut));let dt;U>V?dt=V:dt=U,O={x:b-S,y:dt,width:y,height:ut};break}case"line":{Wt(B[P.key])&&Wt(M[P.key])&&(O={coordinates:[{x:B.x,y:B[P.key]},{x:M.x,y:M[P.key]}]});break}}if(X(O)){const K=P.type;(Q=this.createFigure(K==="bar"?"rect":K,O,j))==null||Q.draw(t)}}})})}}})}}class go extends ht{drawImp(t){const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=e.getPane().getChart().getChartStore(),r=o.getTooltipStore().getCrosshair(),a=o.getStyles().crosshair;if(r.paneId!==void 0&&a.show){if(r.paneId===s.getId()){const c=r.y;this._drawLine(t,[{x:0,y:c},{x:i.width,y:c}],a.horizontal)}const l=r.realX;this._drawLine(t,[{x:l,y:0},{x:l,y:i.height}],a.vertical)}}_drawLine(t,e,s){var i;if(s.show){const o=s.line;o.show&&((i=this.createFigure("line",{coordinates:e},o))==null||i.draw(t))}}}class Qe extends ht{constructor(){super(...arguments),this._boundIconClickEvent=(t,e)=>()=>(this.getWidget().getPane().getChart().getChartStore().getActionStore().execute(lt.OnTooltipIconClick,{...t,iconId:e}),!0),this._boundIconMouseMoveEvent=(t,e)=>()=>(this.getWidget().getPane().getChart().getChartStore().getTooltipStore().setActiveIcon({...t,iconId:e}),!0)}drawImp(t){const e=this.getWidget(),s=e.getPane(),i=s.getChart().getChartStore(),o=i.getTooltipStore().getCrosshair();if(o.kLineData!==void 0){const r=e.getBounding(),a=i.getCustomApi(),l=i.getThousandsSeparator(),c=i.getIndicatorStore().getInstances(s.getId()),h=i.getTooltipStore().getActiveIcon(),u=i.getStyles().indicator;this.drawIndicatorTooltip(t,s.getId(),i.getDataList(),o,h,c,a,l,r,u)}}drawIndicatorTooltip(t,e,s,i,o,r,a,l,c,h,u){const d=h.tooltip;let g=0;if(this.isDrawTooltip(i,d)){const m=d.text;let f=0,_=u??0,p=0;r.forEach(v=>{const{name:x,calcParamsText:S,values:y,icons:C}=this.getIndicatorTooltipData(s,i,v,a,l,h),b=x.length>0,w=y.length>0;if(b||w){const[E,T,I]=this.classifyTooltipIcons(C),[k,L,B,M]=this.drawStandardTooltipIcons(t,c,{paneId:e,indicatorName:v.name,iconId:""},o,E,f,_,p);if(f=k,_=L,g+=M,p=B,b){let V=x;S.length>0&&(V=`${V}${S}`);const[ut,dt,At,_t]=this.drawStandardTooltipLabels(t,c,[{title:{text:"",color:m.color},value:{text:V,color:m.color}}],f,_,p,m);f=ut,_=dt,g+=_t,p=At}const[P,j,st,Q]=this.drawStandardTooltipIcons(t,c,{paneId:e,indicatorName:v.name,iconId:""},o,T,f,_,p);if(f=P,_=j,g+=Q,p=st,w){const[V,ut,dt,At]=this.drawStandardTooltipLabels(t,c,y,f,_,p,m);f=V,_=ut,g+=At,p=dt}const[,U,O,K]=this.drawStandardTooltipIcons(t,c,{paneId:e,indicatorName:v.name,iconId:""},o,I,f,_,p);f=0,g+=K,_=U+O,p=0}})}return g}drawStandardTooltipIcons(t,e,s,i,o,r,a,l){let c=r,h=a,u=0,d=0,g=0;return o.length>0&&(o.forEach(m=>{const{marginLeft:f,marginTop:_,marginRight:p,marginBottom:v,paddingLeft:x,paddingTop:S,paddingRight:y,paddingBottom:C,size:b,fontFamily:w,icon:E}=m;t.font=bt(b,"normal",w),u+=f+x+t.measureText(E).width+y+p,d=Math.max(d,_+S+b+C+v)}),c+u>e.width?(c=o[0].marginLeft,h+=l,g=d):g=Math.max(0,d-l),o.forEach(m=>{var B;const{marginLeft:f,marginTop:_,marginRight:p,paddingLeft:v,paddingTop:x,paddingRight:S,paddingBottom:y,color:C,activeColor:b,size:w,fontFamily:E,icon:T,backgroundColor:I,activeBackgroundColor:k}=m;c+=f;const L=(i==null?void 0:i.paneId)===s.paneId&&(i==null?void 0:i.indicatorName)===s.indicatorName&&(i==null?void 0:i.iconId)===m.id;(B=this.createFigure("text",{text:T,x:c,y:h+_},{paddingLeft:v,paddingTop:x,paddingRight:S,paddingBottom:y,color:L?b:C,size:w,family:E,backgroundColor:L?k:I},{mouseClickEvent:this._boundIconClickEvent(s,m.id),mouseMoveEvent:this._boundIconMouseMoveEvent(s,m.id)}))==null||B.draw(t),c+=v+t.measureText(T).width+S+p})),[c,h,Math.max(l,d),g]}drawStandardTooltipLabels(t,e,s,i,o,r,a){let l=i,c=o,h=0,u=0,d=r;if(s.length>0){const{marginLeft:g,marginTop:m,marginRight:f,marginBottom:_,size:p,family:v,weight:x}=a;t.font=bt(p,x,v),s.forEach(S=>{var I,k;const y=S.title,C=S.value,b=t.measureText(y.text).width,w=t.measureText(C.text).width,E=b+w,T=p+m+_;l+g+E+f>e.width?(l=g,c+=T,u+=T):(l+=g,u+=Math.max(0,T-d)),h=Math.max(d,T),d=h,y.text.length>0&&((I=this.createFigure("text",{x:l,y:c+m,text:y.text},{color:y.color,size:p,family:v,weight:x}))==null||I.draw(t),l+=b),(k=this.createFigure("text",{x:l,y:c+m,text:C.text},{color:C.color,size:p,family:v,weight:x}))==null||k.draw(t),l+=w+f})}return[l,c,h,u]}isDrawTooltip(t,e){const s=e.showRule;return s===ae.Always||s===ae.FollowCross&&t.paneId!==void 0}getIndicatorTooltipData(t,e,s,i,o,r){var f;const a=r.tooltip,l=a.showName?s.shortName:"";let c="";const h=s.calcParams;h.length>0&&a.showParams&&(c=`(${h.join(",")})`);const u={name:l,calcParamsText:c,values:[],icons:a.icons},d=e.dataIndex,g=s.result??[],m=[];if(s.visible){const _=g[d]??{};ue(t,s,d,r,(p,v)=>{if(p.title!==void 0){const x=v.color;let S=_[p.key];X(S)&&(S=z(S,s.precision),s.shouldFormatBigNumber&&(S=i.formatBigNumber(S))),m.push({title:{text:p.title,color:x},value:{text:Y(S??a.defaultValue,o),color:x}})}}),u.values=m}if(s.createTooltipDataSource!==null){const _=this.getWidget(),p=_.getPane(),v=p.getChart().getChartStore(),{name:x,calcParamsText:S,values:y,icons:C}=s.createTooltipDataSource({kLineDataList:t,indicator:s,visibleRange:v.getTimeScaleStore().getVisibleRange(),bounding:_.getBounding(),crosshair:e,defaultStyles:r,xAxis:(f=p.getChart().getPaneById(F.XAXIS))==null?void 0:f.getAxisComponent(),yAxis:p.getAxisComponent()});if(x!==void 0&&a.showName&&(u.name=x),S!==void 0&&a.showParams&&(u.calcParamsText=S),C!==void 0&&(u.icons=C),y!==void 0&&s.visible){const b=[],w=r.tooltip.text.color;y.forEach(E=>{let T={text:"",color:w};rt(E.title)?T=E.title:T.text=E.title;let I={text:"",color:w};rt(E.value)?I=E.value:I.text=E.value,I.text=Y(I.text,o),b.push({title:T,value:I})}),u.values=b}}return u}classifyTooltipIcons(t){const e=[],s=[],i=[];return t.forEach(o=>{switch(o.position){case Zt.Left:{e.push(o);break}case Zt.Middle:{s.push(o);break}case Zt.Right:{i.push(o);break}}}),[e,s,i]}}class ts extends ht{constructor(t){super(t),this._initEvent()}_initEvent(){const t=this.getWidget().getPane(),e=t.getId(),s=t.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",i=>{var r;const o=s.getProgressInstanceInfo();if(o!==null){const a=o.instance;let l=o.paneId;a.isStart()&&(s.updateProgressInstanceInfo(e),l=e);const c=a.points.length-1,h=`${It}point_${c}`;return a.isDrawing()&&l===e&&(a.eventMoveForDrawing(this._coordinateToPoint(o.instance,i)),(r=a.onDrawing)==null||r.call(a,{overlay:a,figureKey:h,figureIndex:c,...i})),this._figureMouseMoveEvent(a,G.Point,h,c,0)(i)}return s.setHoverInstanceInfo({paneId:e,instance:null,figureType:G.None,figureKey:"",figureIndex:-1,attrsIndex:-1},i),!1}).registerEvent("mouseClickEvent",i=>{var r,a;const o=s.getProgressInstanceInfo();if(o!==null){const l=o.instance;let c=o.paneId;l.isStart()&&(s.updateProgressInstanceInfo(e,!0),c=e);const h=l.points.length-1,u=`${It}point_${h}`;return l.isDrawing()&&c===e&&(l.eventMoveForDrawing(this._coordinateToPoint(l,i)),(r=l.onDrawing)==null||r.call(l,{overlay:l,figureKey:u,figureIndex:h,...i}),l.nextStep(),l.isDrawing()||(s.progressInstanceComplete(),(a=l.onDrawEnd)==null||a.call(l,{overlay:l,figureKey:u,figureIndex:h,...i}))),this._figureMouseClickEvent(l,G.Point,u,h,0)(i)}return s.setClickInstanceInfo({paneId:e,instance:null,figureType:G.None,figureKey:"",figureIndex:-1,attrsIndex:-1},i),!1}).registerEvent("mouseDoubleClickEvent",i=>{var r;const o=s.getProgressInstanceInfo();if(o!==null){const a=o.instance,l=o.paneId;if(a.isDrawing()&&l===e&&(a.forceComplete(),!a.isDrawing())){s.progressInstanceComplete();const h=a.points.length-1,u=`${It}point_${h}`;(r=a.onDrawEnd)==null||r.call(a,{overlay:a,figureKey:u,figureIndex:h,...i})}const c=a.points.length-1;return this._figureMouseClickEvent(a,G.Point,`${It}point_${c}`,c,0)(i)}return!1}).registerEvent("mouseRightClickEvent",i=>{const o=s.getProgressInstanceInfo();if(o!==null){const r=o.instance;if(r.isDrawing()){const a=r.points.length-1;return this._figureMouseRightClickEvent(r,G.Point,`${It}point_${a}`,a,0)(i)}}return!1}).registerEvent("mouseUpEvent",i=>{var l;const{instance:o,figureIndex:r,figureKey:a}=s.getPressedInstanceInfo();return o!==null&&((l=o.onPressedMoveEnd)==null||l.call(o,{overlay:o,figureKey:a,figureIndex:r,...i})),s.setPressedInstanceInfo({paneId:e,instance:null,figureType:G.None,figureKey:"",figureIndex:-1,attrsIndex:-1}),!1}).registerEvent("pressedMouseMoveEvent",i=>{var c;const{instance:o,figureType:r,figureIndex:a,figureKey:l}=s.getPressedInstanceInfo();if(o!==null){if(!o.lock&&!(((c=o.onPressedMoving)==null?void 0:c.call(o,{overlay:o,figureIndex:a,figureKey:l,...i}))??!1)){const h=this._coordinateToPoint(o,i);r===G.Point?o.eventPressedPointMove(h,a):o.eventPressedOtherMove(h,this.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1})}_createFigureEvents(t,e,s,i,o,r){let a;if(!t.isDrawing()){let l=[];if(r!==void 0&&(fs(r)?r&&(l=gi()):l=r),l.length===0)return{mouseMoveEvent:this._figureMouseMoveEvent(t,e,s,i,o),mouseDownEvent:this._figureMouseDownEvent(t,e,s,i,o),mouseClickEvent:this._figureMouseClickEvent(t,e,s,i,o),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,s,i,o),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,e,s,i,o)};a={},!l.includes("mouseMoveEvent")&&!l.includes("touchMoveEvent")&&(a.mouseMoveEvent=this._figureMouseMoveEvent(t,e,s,i,o)),!l.includes("mouseDownEvent")&&!l.includes("touchStartEvent")&&(a.mouseDownEvent=this._figureMouseDownEvent(t,e,s,i,o)),!l.includes("mouseClickEvent")&&!l.includes("tapEvent")&&(a.mouseClickEvent=this._figureMouseClickEvent(t,e,s,i,o)),!l.includes("mouseDoubleClickEvent")&&!l.includes("doubleTapEvent")&&(a.mouseDoubleClickEvent=this._figureMouseDoubleClickEvent(t,e,s,i,o)),l.includes("mouseRightClickEvent")||(a.mouseRightClickEvent=this._figureMouseRightClickEvent(t,e,s,i,o))}return a}_figureMouseMoveEvent(t,e,s,i,o){return r=>{const a=this.getWidget().getPane();return a.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:a.getId(),instance:t,figureType:e,figureKey:s,figureIndex:i,attrsIndex:o},r),!0}}_figureMouseDownEvent(t,e,s,i,o){return r=>{var h;const a=this.getWidget().getPane(),l=a.getId(),c=a.getChart().getChartStore().getOverlayStore();return t.startPressedMove(this._coordinateToPoint(t,r)),(h=t.onPressedMoveStart)==null||h.call(t,{overlay:t,figureIndex:i,figureKey:s,...r}),c.setPressedInstanceInfo({paneId:l,instance:t,figureType:e,figureKey:s,figureIndex:i,attrsIndex:o}),!0}}_figureMouseClickEvent(t,e,s,i,o){return r=>{const a=this.getWidget().getPane(),l=a.getId();return a.getChart().getChartStore().getOverlayStore().setClickInstanceInfo({paneId:l,instance:t,figureType:e,figureKey:s,figureIndex:i,attrsIndex:o},r),!0}}_figureMouseDoubleClickEvent(t,e,s,i,o){return r=>{var a;return(a=t.onDoubleClick)==null||a.call(t,{...r,figureIndex:i,figureKey:s,overlay:t}),!0}}_figureMouseRightClickEvent(t,e,s,i,o){return r=>{var a;return(((a=t.onRightClick)==null?void 0:a.call(t,{overlay:t,figureIndex:i,figureKey:s,...r}))??!1)||this.getWidget().getPane().getChart().getChartStore().getOverlayStore().removeInstance(t),!0}}_coordinateToPoint(t,e){var l;const s={},i=this.getWidget().getPane(),o=i.getChart(),r=i.getId(),a=o.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){const h=((l=o.getPaneById(F.XAXIS))==null?void 0:l.getAxisComponent()).convertFromPixel(e.x),u=a.dataIndexToTimestamp(h)??void 0;s.dataIndex=h,s.timestamp=u}if(this.coordinateToPointValueFlag()){const c=i.getAxisComponent();let h=c.convertFromPixel(e.y);if(t.mode!==Gt.Normal&&r===F.CANDLE&&s.dataIndex!==void 0){const u=a.getDataByDataIndex(s.dataIndex);if(u!==null){const d=t.modeSensitivity;if(h>u.high)if(t.mode===Gt.WeakMagnet){const g=c.convertToPixel(u.high),m=c.convertFromPixel(g-d);h<m&&(h=u.high)}else h=u.high;else if(h<u.low)if(t.mode===Gt.WeakMagnet){const g=c.convertToPixel(u.low),m=c.convertFromPixel(g-d);h>m&&(h=u.low)}else h=u.low;else{const g=Math.max(u.open,u.close),m=Math.min(u.open,u.close);h>g?h-g<u.high-h?h=g:h=u.high:h<m?h-u.low<m-h?h=u.low:h=m:g-h<h-m?h=g:h=m}}}s.value=h}return s}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e,s){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,e,s):super.dispatchEvent(t,e,s)}checkEventOn(){return!0}drawImp(t){var C;const e=this.getWidget(),s=e.getPane(),i=s.getId(),o=s.getChart(),r=s.getAxisComponent(),a=(C=o.getPaneById(F.XAXIS))==null?void 0:C.getAxisComponent(),l=e.getBounding(),c=o.getChartStore(),h=c.getCustomApi(),u=c.getThousandsSeparator(),d=c.getTimeScaleStore(),g=d.getDateTimeFormat(),m=d.getBarSpace(),f=c.getPrecision(),_=c.getStyles().overlay,p=c.getOverlayStore(),v=p.getHoverInstanceInfo(),x=p.getClickInstanceInfo();this.getCompleteOverlays(p,i).forEach(b=>{b.visible&&this._drawOverlay(t,b,l,m,f,g,h,u,_,a,r,v,x,d)});const y=p.getProgressInstanceInfo();if(y!==null){const b=this.getProgressOverlay(y,i);b!==null&&b.visible&&this._drawOverlay(t,b,l,m,f,g,h,u,_,a,r,v,x,d)}}_drawOverlay(t,e,s,i,o,r,a,l,c,h,u,d,g,m){const{points:f}=e,_=f.map(p=>{let v=p.dataIndex;p.timestamp!==void 0&&(v=m.timestampToDataIndex(p.timestamp));const x={x:0,y:0};return v!==void 0&&(x.x=(h==null?void 0:h.convertToPixel(v))??0),p.value!==void 0&&(x.y=(u==null?void 0:u.convertToPixel(p.value))??0),x});if(_.length>0){const p=new Array().concat(this.getFigures(e,_,s,i,o,l,r,c,h,u));this.drawFigures(t,e,p,c)}this.drawDefaultFigures(t,e,_,s,o,r,a,l,c,h,u,d,g)}drawFigures(t,e,s,i){s.forEach((o,r)=>{const{type:a,styles:l,attrs:c,ignoreEvent:h}=o;[].concat(c).forEach((d,g)=>{var _,p;const m=this._createFigureEvents(e,G.Other,o.key??"",r,g,h),f={...i[a],...(_=e.styles)==null?void 0:_[a],...l};(p=this.createFigure(a,d,f,m))==null||p.draw(t)})})}getCompleteOverlays(t,e){return t.getInstances(e)}getProgressOverlay(t,e){return t.paneId===e?t.instance:null}getFigures(t,e,s,i,o,r,a,l,c,h){var u;return((u=t.createPointFigures)==null?void 0:u.call(t,{overlay:t,coordinates:e,bounding:s,barSpace:i,precision:o,thousandsSeparator:r,dateTimeFormat:a,defaultStyles:l,xAxis:c,yAxis:h}))??[]}drawDefaultFigures(t,e,s,i,o,r,a,l,c,h,u,d,g){var m,f;if(e.needDefaultPointFigure&&(((m=d.instance)==null?void 0:m.id)===e.id&&d.figureType!==G.None||((f=g.instance)==null?void 0:f.id)===e.id&&g.figureType!==G.None)){const _=e.styles,p={...c.point,..._==null?void 0:_.point};s.forEach(({x:v,y:x},S)=>{var E,T,I;let y=p.radius,C=p.color,b=p.borderColor,w=p.borderSize;((E=d.instance)==null?void 0:E.id)===e.id&&d.figureType===G.Point&&d.figureIndex===S&&(y=p.activeRadius,C=p.activeColor,b=p.activeBorderColor,w=p.activeBorderSize),(T=this.createFigure("circle",{x:v,y:x,r:y+w},{color:b},this._createFigureEvents(e,G.Point,`${It}point_${S}`,S,0)))==null||T.draw(t),(I=this.createFigure("circle",{x:v,y:x,r:y},{color:C}))==null||I.draw(t)})}}}class es extends _e{constructor(t,e){super(t,e),this._gridView=new ho(this),this._indicatorView=new uo(this),this._crosshairLineView=new go(this),this._tooltipView=this.createTooltipView(),this._overlayView=new ts(this),this.addChild(this._tooltipView),this.addChild(this._overlayView),this.getContainer().style.cursor="crosshair",this.registerEvent("mouseMoveEvent",()=>(e.getChart().getChartStore().getTooltipStore().setActiveIcon(),!1))}getName(){return D.MAIN}updateMain(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)}createTooltipView(){return new Qe(this)}updateMainContent(t){}updateOverlay(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)}}class fo extends ve{drawImp(t){var d,g;const e=this.getWidget(),s=e.getPane(),i=s.getChart(),o=e.getBounding(),r=s.getAxisComponent(),a=i.getStyles().candle.area,l=[],c=[];let h=Number.MAX_SAFE_INTEGER;this.eachChildren((m,f,_)=>{const{data:p,x:v}=m,{halfGapBar:x}=f,S=p[a.value];if(Wt(S)){const y=r.convertToPixel(S);if(_===0){const C=v-x;c.push({x:C,y:o.height}),c.push({x:C,y}),l.push({x:C,y})}l.push({x:v,y}),c.push({x:v,y}),h=Math.min(h,y)}});const u=c.length;if(u>0){const m=c[u-1],f=m.x;l.push({x:f,y:m.y}),c.push({x:f,y:m.y}),c.push({x:f,y:o.height})}if(l.length>0&&((d=this.createFigure("line",{coordinates:l},{color:a.lineColor,size:a.lineSize}))==null||d.draw(t)),c.length>0){const m=a.backgroundColor;let f;if(nt(m)){const _=t.createLinearGradient(0,o.height,0,h);try{m.forEach(({offset:p,color:v})=>{_.addColorStop(p,v)})}catch{}f=_}else f=m;(g=this.createFigure("polygon",{coordinates:c},{color:f}))==null||g.draw(t)}}}class mo extends ve{drawImp(t){const s=this.getWidget().getPane(),i=s.getChart().getChartStore(),o=i.getStyles().candle.priceMark,r=o.high,a=o.low;if(o.show&&(r.show||a.show)){const l=i.getThousandsSeparator(),c=i.getPrecision(),h=s.getAxisComponent();let u=Number.MIN_SAFE_INTEGER,d=0,g=Number.MAX_SAFE_INTEGER,m=0;this.eachChildren(p=>{const{data:v,x}=p;u<v.high&&(u=v.high,d=x),g>v.low&&(g=v.low,m=x)});const f=h.convertToPixel(u),_=h.convertToPixel(g);r.show&&u!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,Y(z(u,c.price),l),{x:d,y:f},f<_?[-2,-5]:[2,5],r),a.show&&g!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,Y(z(g,c.price),l),{x:m,y:_},f<_?[2,5]:[-2,-5],a)}}_drawMark(t,e,s,i,o){var g,m,f;const r=s.x,a=s.y+i[0];(g=this.createFigure("line",{coordinates:[{x:r-2,y:a+i[0]},{x:r,y:a},{x:r+2,y:a+i[0]}]},{color:o.color}))==null||g.draw(t);let l,c,h;const{width:u}=this.getWidget().getBounding();r>u/2?(l=r-5,c=l-o.textOffset,h="right"):(l=r+5,h="left",c=l+o.textOffset);const d=a+i[1];(m=this.createFigure("line",{coordinates:[{x:r,y:a},{x:r,y:d},{x:l,y:d}]},{color:o.color}))==null||m.draw(t),(f=this.createFigure("text",{x:c,y:d,text:e,align:h,baseline:"middle"},{color:o.color,size:o.textSize,family:o.textFamily,weight:o.textWeight}))==null||f.draw(t)}}class po extends ht{drawImp(t){var c;const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=s.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.last,l=a.line;if(r.show&&a.show&&l.show){const h=s.getAxisComponent(),u=o.getDataList(),d=u[u.length-1];if(d!=null){const{close:g,open:m}=d,f=h.convertToNicePixel(g);let _;g>m?_=a.upColor:g<m?_=a.downColor:_=a.noChangeColor,(c=this.createFigure("line",{coordinates:[{x:0,y:f},{x:i.width,y:f}]},{style:l.style,color:_,size:l.size,dashedValue:l.dashedValue}))==null||c.draw(t)}}}}const _o={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",change:"涨幅："},vo={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",change:"Change: "},he={"zh-CN":_o,"en-US":vo};function ln(n,t){he[n]={...he[n],...t}}function xo(n,t){var e;return((e=he[t])==null?void 0:e[n])??n}class So extends Qe{drawImp(t){var a;const e=this.getWidget(),s=e.getPane(),i=s.getId(),o=s.getChart().getChartStore(),r=o.getTooltipStore().getCrosshair();if(r.kLineData!==void 0){const l=e.getBounding(),c=(a=s.getYAxisWidget())==null?void 0:a.getBounding(),h=o.getDataList(),u=o.getPrecision(),d=o.getLocale(),g=o.getCustomApi(),m=o.getThousandsSeparator(),f=o.getTooltipStore().getActiveIcon(),_=o.getIndicatorStore().getInstances(s.getId()),p=o.getTimeScaleStore().getDateTimeFormat(),v=o.getStyles(),x=v.candle,S=v.indicator;if(x.tooltip.showType===St.Rect&&S.tooltip.showType===St.Rect){const y=this.isDrawTooltip(r,x.tooltip),C=this.isDrawTooltip(r,S.tooltip);this._drawRectTooltip(t,h,_,l,c,r,u,p,d,g,m,y,C,v,0)}else if(x.tooltip.showType===St.Standard&&S.tooltip.showType===St.Standard){const y=this._drawCandleStandardTooltip(t,h,i,l,r,f,u,p,d,g,m,x);this.drawIndicatorTooltip(t,i,h,r,f,_,g,m,l,S,y)}else if(x.tooltip.showType===St.Rect&&S.tooltip.showType===St.Standard){const y=this.drawIndicatorTooltip(t,i,h,r,f,_,g,m,l,S,0),C=this.isDrawTooltip(r,x.tooltip);this._drawRectTooltip(t,h,_,l,c,r,u,p,d,g,m,C,!1,v,y)}else{const y=this._drawCandleStandardTooltip(t,h,i,l,r,f,u,p,d,g,m,x),C=this.isDrawTooltip(r,S.tooltip);this._drawRectTooltip(t,h,_,l,c,r,u,p,d,g,m,!1,C,v,y)}}}_drawCandleStandardTooltip(t,e,s,i,o,r,a,l,c,h,u,d){const g=d.tooltip,m=g.text;let f=0;if(this.isDrawTooltip(o,g)){const _=o.dataIndex??0,p=this._getCandleTooltipData({prev:e[_-1]??null,current:o.kLineData,next:e[_+1]??null},a,l,c,h,u,d);let v=0,x=0,S=0;const[y,C,b]=this.classifyTooltipIcons(g.icons),[w,E,T,I]=this.drawStandardTooltipIcons(t,i,{paneId:s,indicatorName:"",iconId:""},r,y,v,x,0);v=w,x=E,f+=I,S=T;const[k,L,B,M]=this.drawStandardTooltipIcons(t,i,{paneId:s,indicatorName:"",iconId:""},r,C,v,x,S);if(v=k,x=L,f+=M,S=B,p.length>0){const[U,O,K,V]=this.drawStandardTooltipLabels(t,i,p,v,x,S,m);v=U,x=O,f+=V,S=K}const[P,j,st,Q]=this.drawStandardTooltipIcons(t,i,{paneId:s,indicatorName:"",iconId:""},r,b,v,x,S);v=P,x=j,f+=Q,S=st}return f}_drawRectTooltip(t,e,s,i,o,r,a,l,c,h,u,d,g,m,f){var S;const _=m.candle,p=m.indicator,v=_.tooltip,x=p.tooltip;if(d||g){const y=r.dataIndex??0,C=this._getCandleTooltipData({prev:e[y-1]??null,current:r.kLineData,next:e[y+1]??null},a,l,c,h,u,_),{marginLeft:b,marginRight:w,marginTop:E,marginBottom:T,size:I,weight:k,family:L}=v.text,{position:B,paddingLeft:M,paddingRight:P,paddingTop:j,paddingBottom:st,offsetLeft:Q,offsetRight:U,offsetTop:O,offsetBottom:K,borderSize:V,borderRadius:ut,borderColor:dt,color:At}=v.rect;let _t=0,gt=0,ft=0;d&&(t.font=bt(I,k,L),C.forEach(wt=>{const vt=wt.title,xt=wt.value,H=`${vt.text}${xt.text}`,tt=t.measureText(H).width+b+w;_t=Math.max(_t,tt)}),ft+=(T+E+I)*C.length);const{marginLeft:xe,marginRight:Se,marginTop:Ce,marginBottom:ye,size:kt,weight:ee,family:se}=x.text,be=[];if(g&&(t.font=bt(kt,ee,se),s.forEach(wt=>{const vt=this.getIndicatorTooltipData(e,r,wt,h,u,p).values??[];be.push(vt),vt.forEach(xt=>{const H=xt.title,tt=xt.value,ie=`${H.text}${tt.text}`,it=t.measureText(ie).width+xe+Se;_t=Math.max(_t,it),ft+=Ce+ye+kt})})),gt+=_t,gt!==0&&ft!==0){gt+=V*2+M+P,ft+=V*2+j+st;const wt=i.width/2,vt=B===Ve.Pointer&&r.paneId===F.CANDLE,xt=(r.realX??0)>wt;let H=0;if(vt){const mt=r.realX;xt?H=mt-U-gt:H=mt+Q}else xt?(H=Q,m.yAxis.inside&&m.yAxis.position===Pt.Left&&(H+=o.width)):(H=i.width-U-gt,m.yAxis.inside&&m.yAxis.position===Pt.Right&&(H-=o.width));let tt=f+O;vt&&(tt=r.y-ft/2,tt+ft>i.height-K&&(tt=i.height-K-ft),tt<f+O&&(tt=f+O)),(S=this.createFigure("rect",{x:H,y:tt,width:gt,height:ft},{style:R.StrokeFill,color:At,borderColor:dt,borderSize:V,borderRadius:ut}))==null||S.draw(t);const ie=H+V+M+b;let it=tt+V+j;if(d&&C.forEach(mt=>{var Rt,Lt;it+=E;const zt=mt.title;(Rt=this.createFigure("text",{x:ie,y:it,text:zt.text},{color:zt.color,size:I,family:L,weight:k}))==null||Rt.draw(t);const Ft=mt.value;(Lt=this.createFigure("text",{x:H+gt-V-w-P,y:it,text:Ft.text,align:"right"},{color:Ft.color,size:I,family:L,weight:k}))==null||Lt.draw(t),it+=I+T}),g){const mt=H+V+M+xe;be.forEach(zt=>{zt.forEach(Ft=>{var we,Ie;it+=Ce;const Rt=Ft.title,Lt=Ft.value;(we=this.createFigure("text",{x:mt,y:it,text:Rt.text},{color:Rt.color,size:kt,family:se,weight:ee}))==null||we.draw(t),(Ie=this.createFigure("text",{x:H+gt-V-Se-P,y:it,text:Lt.text,align:"right"},{color:Lt.color,size:kt,family:se,weight:ee}))==null||Ie.draw(t),it+=kt+ye})})}}}}_getCandleTooltipData(t,e,s,i,o,r,a){var p,v;const l=a.tooltip,c=l.text.color,h=t.current,u=((p=t.prev)==null?void 0:p.close)??h.close,d=h.close-u,{price:g,volume:m}=e,f={"{time}":o.formatDate(s,h.timestamp,"YYYY-MM-DD HH:mm",Z.Tooltip),"{open}":Y(z(h.open,g),r),"{high}":Y(z(h.high,g),r),"{low}":Y(z(h.low,g),r),"{close}":Y(z(h.close,g),r),"{volume}":Y(o.formatBigNumber(z(h.volume??l.defaultValue,m)),r),"{change}":u===0?l.defaultValue:`${z(d/u*100)}%`};return((Ot(l.custom)?(v=l.custom)==null?void 0:v.call(l,t,a):l.custom)??[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]).map(({title:x,value:S})=>{let y={text:"",color:""};rt(x)?y={...x}:(y.text=x,y.color=c),y.text=xo(y.text,i);let C={text:l.defaultValue,color:""};rt(S)?C={...S}:(C.text=S,C.color=c);const b=C.text.match(/{(\S*)}/);if(b!==null&&b.length>1){const w=`{${b[1]}}`;C.text=C.text.replace(w,f[w]??l.defaultValue),w==="{change}"&&(C.color=d===0?a.priceMark.last.noChangeColor:d>0?a.priceMark.last.upColor:a.priceMark.last.downColor)}return{title:y,value:C}})}}class Co extends es{constructor(t,e){super(t,e),this._candleBarView=new Je(this),this._candleAreaView=new fo(this),this._candleHighLowPriceView=new mo(this),this._candleLastPriceLineView=new po(this),this.addChild(this._candleBarView)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!==pt.Area?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t)):this._candleAreaView.draw(t),this._candleLastPriceLineView.draw(t)}createTooltipView(){return new So(this)}}class ss extends ht{drawImp(t){var a;const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=s.getAxisComponent(),r=this.getAxisStyles(s.getChart().getStyles());if(r.show){r.axisLine.show&&((a=this.createFigure("line",this.createAxisLine(i,r),r.axisLine))==null||a.draw(t));const l=o.getTicks();r.tickLine.show&&this.createTickLines(l,i,r).forEach(h=>{var u;(u=this.createFigure("line",h,r.tickLine))==null||u.draw(t)}),r.tickText.show&&this.createTickTexts(l,i,r).forEach(h=>{var u;(u=this.createFigure("text",h,r.tickText))==null||u.draw(t)})}}}class yo extends ss{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const s=this.getWidget().getPane().getAxisComponent(),i=e.axisLine.size;let o;return s.isFromZero()?o=i/2:o=t.width-i,{coordinates:[{x:o,y:0},{x:o,y:t.height}]}}createTickLines(t,e,s){const i=this.getWidget().getPane().getAxisComponent(),o=s.axisLine,r=s.tickLine;let a=0,l=0;return i.isFromZero()?(a=0,o.show&&(a+=o.size),l=a+r.length):(a=e.width,o.show&&(a-=o.size),l=a-r.length),t.map(c=>({coordinates:[{x:a,y:c.coord},{x:l,y:c.coord}]}))}createTickTexts(t,e,s){const i=this.getWidget().getPane().getAxisComponent(),o=s.axisLine,r=s.tickLine,a=s.tickText;let l=0;i.isFromZero()?(l=a.marginStart,o.show&&(l+=o.size),r.show&&(l+=r.length)):(l=e.width-a.marginEnd,o.show&&(l-=o.size),r.show&&(l-=r.length));const c=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map(h=>({x:l,y:h.coord,text:h.text,align:c,baseline:"middle"}))}}class bo extends ht{drawImp(t){var c;const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=s.getChart().getChartStore(),r=o.getStyles().candle.priceMark,a=r.last,l=a.text;if(r.show&&a.show&&l.show){const h=o.getPrecision(),u=s.getAxisComponent(),d=o.getDataList(),g=o.getVisibleDataList(),m=d[d.length-1];if(m!==void 0){const{close:f,open:_}=m,p=u.convertToNicePixel(f);let v;f>_?v=a.upColor:f<_?v=a.downColor:v=a.noChangeColor;let x;if(u.getType()===$.Percentage){const b=g[0].data.close;x=`${((f-b)/b*100).toFixed(2)}%`}else x=z(f,h.price);x=Y(x,o.getThousandsSeparator());let S,y;u.isFromZero()?(S=0,y="left"):(S=i.width,y="right"),(c=this.createFigure("text",{x:S,y:p,text:x,align:y,baseline:"middle"},{...l,backgroundColor:v}))==null||c.draw(t)}}}}class wo extends ht{drawImp(t){const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=s.getChart().getChartStore(),r=o.getCustomApi(),a=o.getStyles().indicator,l=a.lastValueMark,c=l.text;if(l.show){const h=s.getAxisComponent(),u=o.getDataList(),d=u.length-1,g=o.getIndicatorStore().getInstances(s.getId()),m=o.getThousandsSeparator();g.forEach(f=>{const p=f.result[d];if(p!==void 0&&f.visible){const v=f.precision;ue(u,f,d,a,(x,S)=>{var C;const y=p[x.key];if(X(y)){const b=h.convertToNicePixel(y);let w=z(y,v);f.shouldFormatBigNumber&&(w=r.formatBigNumber(w)),w=Y(w,m);let E,T;h.isFromZero()?(E=0,T="left"):(E=i.width,T="right"),(C=this.createFigure("text",{x:E,y:b,text:w,align:T,baseline:"middle"},{...c,backgroundColor:S.color}))==null||C.draw(t)}})}})}}}class is extends ts{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,s,i,o,r,a,l,c,h,u,d,g){this.drawFigures(t,e,this.getDefaultFigures(e,s,i,o,r,a,l,h,u,g),c)}getDefaultFigures(t,e,s,i,o,r,a,l,c,h){var d;const u=[];if(t.needDefaultYAxisFigure&&t.id===((d=h.instance)==null?void 0:d.id)&&h.paneId===this.getWidget().getPane().getId()){let g=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER;const f=(c==null?void 0:c.isFromZero())??!1;let _,p;f?(_="left",p=0):(_="right",p=s.width),e.forEach((v,x)=>{const S=t.points[x];if(S.value!==void 0){g=Math.min(g,v.y),m=Math.max(m,v.y);const y=Y(z(S.value,i.price),a);u.push({type:"text",attrs:{x:p,y:v.y,text:y,align:_,baseline:"middle"},ignoreEvent:!0})}}),e.length>1&&u.unshift({type:"rect",attrs:{x:0,y:g,width:s.width,height:m-g},ignoreEvent:!0})}return u}getFigures(t,e,s,i,o,r,a,l,c,h){var u;return((u=t.createYAxisFigures)==null?void 0:u.call(t,{overlay:t,coordinates:e,bounding:s,barSpace:i,precision:o,thousandsSeparator:r,dateTimeFormat:a,defaultStyles:l,xAxis:c,yAxis:h}))??[]}}class os extends ht{drawImp(t){var l;const e=this.getWidget(),s=e.getPane(),i=e.getBounding(),o=e.getPane().getChart().getChartStore(),r=o.getTooltipStore().getCrosshair(),a=o.getStyles().crosshair;if(r.paneId!==void 0&&this.compare(r,s.getId())&&a.show){const c=this.getDirectionStyles(a),h=c.text;if(c.show&&h.show){const u=s.getAxisComponent(),d=this.getText(r,o,u);t.font=bt(h.size,h.weight,h.family),(l=this.createFigure("text",this.getTextAttrs(d,t.measureText(d).width,r,i,u,h),h))==null||l.draw(t)}}}compare(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,s){var a;const i=s,o=s.convertFromPixel(t.y);let r;if(i.getType()===$.Percentage){const c=((a=e.getVisibleDataList()[0])==null?void 0:a.data)??{};r=`${((o-c.close)/c.close*100).toFixed(2)}%`}else{const l=e.getIndicatorStore().getInstances(t.paneId);let c=0,h=!1;i.isInCandle()?c=e.getPrecision().price:l.forEach(u=>{c=Math.max(u.precision,c),h||(h=u.shouldFormatBigNumber)}),r=z(o,c),h&&(r=e.getCustomApi().formatBigNumber(r))}return Y(r,e.getThousandsSeparator())}getTextAttrs(t,e,s,i,o,r){const a=o;let l,c;return a.isFromZero()?(l=0,c="left"):(l=i.width,c="right"),{x:l,y:s.y,text:t,align:c,baseline:"middle"}}}class Io extends _e{constructor(t,e){super(t,e),this._yAxisView=new yo(this),this._candleLastPriceLabelView=new bo(this),this._indicatorLastValueView=new wo(this),this._overlayYAxisView=new is(this),this._crosshairHorizontalLabelView=new os(this),this.getContainer().style.cursor="ns-resize",this.addChild(this._overlayYAxisView)}getName(){return D.YAXIS}updateMain(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)}updateOverlay(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)}}class ns{constructor(t){this._extremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._prevExtremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._extremum=this.calcExtremum()),this._prevExtremum.min!==this._extremum.min||this._prevExtremum.max!==this._extremum.max||t?(this._prevExtremum=this._extremum,this._ticks=this.optimalTicks(this._calcTicks()),!0):!1}getTicks(){return this._ticks}getScrollZoomEnabled(){return this.getParent().getOptions().axisOptions.scrollZoomEnabled??!0}setExtremum(t){this._autoCalcTickFlag=!1,this._extremum=t}getExtremum(){return this._extremum}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}_calcTicks(){const{realMin:t,realMax:e,realRange:s}=this._extremum,i=[];if(s>=0){const[o,r]=this._calcTickInterval(s),a=Te(Math.ceil(t/o)*o,r),l=Te(Math.floor(e/o)*o,r);let c=0,h=a;if(o!==0)for(;h<=l;){const u=h.toFixed(r);i[c]={text:u,coord:0,value:u},++c,h+=o}}return i}_calcTickInterval(t){const e=As(t/8),s=ks(e);return[e,s]}}class Eo extends ns{calcExtremum(){var L,B;const t=this.getParent(),e=t.getChart(),s=e.getChartStore();let i=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;const r=[];let a=!1,l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER;s.getIndicatorStore().getInstances(t.getId()).forEach(M=>{a||(a=M.shouldOhlc??!1),h=Math.min(h,M.precision),M.minValue!==null&&(l=Math.min(l,M.minValue)),M.maxValue!==null&&(c=Math.max(c,M.maxValue)),r.push({figures:M.figures??[],result:M.result??[]})});let d=4;const g=this.isInCandle();if(g){const{price:M}=s.getPrecision();h!==Number.MAX_SAFE_INTEGER?d=Math.min(h,M):d=M}else h!==Number.MAX_SAFE_INTEGER&&(d=h);const m=s.getVisibleDataList(),f=e.getStyles().candle,_=f.type===pt.Area,p=f.area.value,v=g&&!_||!g&&a;m.forEach(({dataIndex:M,data:P})=>{if(v&&(i=Math.min(i,P.low),o=Math.max(o,P.high)),g&&_){const j=P[p];i=Math.min(i,j),o=Math.max(o,j)}r.forEach(({figures:j,result:st})=>{const Q=st[M]??{};j.forEach(U=>{const O=Q[U.key];X(O)&&(i=Math.min(i,O),o=Math.max(o,O))})})}),i!==Number.MAX_SAFE_INTEGER&&o!==Number.MIN_SAFE_INTEGER?(i=Math.min(l,i),o=Math.max(c,o)):(i=0,o=10);const x=this.getType();let S;switch(x){case $.Percentage:{const M=(L=m[0])==null?void 0:L.data;(M==null?void 0:M.close)!==void 0&&(i=(i-M.close)/M.close*100,o=(o-M.close)/M.close*100),S=Math.pow(10,-2);break}case $.Log:{i=Nt(i),o=Nt(o),S=.05*Ct(-d);break}default:S=Ct(-d)}if(i===o||Math.abs(i-o)<S){const M=l===i,P=c===o;i=M?i:P?i-8*S:i-4*S,o=P?o:M?o+8*S:o+4*S}const y=((B=this.getParent().getYAxisWidget())==null?void 0:B.getBounding().height)??0,{gap:C}=t.getOptions();let b=(C==null?void 0:C.top)??.2;b>=1&&(b=b/y);let w=(C==null?void 0:C.bottom)??.1;w>=1&&(w=w/y);let E=Math.abs(o-i);i=i-E*w,o=o+E*b,E=Math.abs(o-i);let T,I,k;return x===$.Log?(T=Ct(i),I=Ct(o),k=Math.abs(I-T)):(T=i,I=o,k=E),{min:i,max:o,range:E,realMin:T,realMax:I,realRange:k}}_innerConvertToPixel(t){var r;const e=((r=this.getParent().getYAxisWidget())==null?void 0:r.getBounding().height)??0,{min:s,range:i}=this.getExtremum(),o=(t-s)/i;return this.isReverse()?Math.round(o*e):Math.round((1-o)*e)}isInCandle(){return this.getParent().getName()==="candle"}getType(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:$.Normal}getPosition(){return this.getParent().getChart().getStyles().yAxis.position}isReverse(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.reverse:!1}isFromZero(){const t=this.getParent().getChart().getStyles().yAxis,e=t.inside;return t.position===Pt.Left&&e||t.position===Pt.Right&&!e}optimalTicks(t){var m;const e=this.getParent(),s=((m=e.getYAxisWidget())==null?void 0:m.getBounding().height)??0,i=e.getChart().getChartStore(),o=i.getCustomApi(),r=[],a=this.getType(),l=i.getIndicatorStore().getInstances(e.getId()),c=i.getThousandsSeparator();let h=0,u=!1;this.isInCandle()?h=i.getPrecision().price:l.forEach(f=>{h=Math.max(h,f.precision),u||(u=f.shouldFormatBigNumber)});const d=i.getStyles().xAxis.tickText.size;let g;return t.forEach(({value:f})=>{let _,p=this._innerConvertToPixel(+f);switch(a){case $.Percentage:{_=`${z(f,2)}%`;break}case $.Log:{p=this._innerConvertToPixel(Nt(+f)),_=z(f,h);break}default:{_=z(f,h),u&&(_=o.formatBigNumber(f));break}}_=Y(_,c),p>d&&p<s-d&&(g!==void 0&&Math.abs(g-p)>d*2||g===void 0)&&(r.push({text:_,coord:p,value:f}),g=p)}),r}getAutoSize(){const t=this.getParent(),e=t.getChart(),s=e.getStyles(),i=s.yAxis,o=i.size;if(o!=="auto")return o;const r=e.getChartStore(),a=r.getCustomApi();let l=0;if(i.show&&(i.axisLine.show&&(l+=i.axisLine.size),i.tickLine.show&&(l+=i.tickLine.length),i.tickText.show)){let u=0;this.getTicks().forEach(d=>{u=Math.max(u,jt(d.text,i.tickText.size,i.tickText.weight,i.tickText.family))}),l+=i.tickText.marginStart+i.tickText.marginEnd+u}const c=s.crosshair;let h=0;if(c.show&&c.horizontal.show&&c.horizontal.text.show){const u=r.getIndicatorStore().getInstances(t.getId());let d=0,g=!1;u.forEach(_=>{d=Math.max(_.precision,d),g||(g=_.shouldFormatBigNumber)});let m=2;if(this.getType()!==$.Percentage)if(this.isInCandle()){const{price:_}=r.getPrecision(),p=s.indicator.lastValueMark;p.show&&p.text.show?m=Math.max(d,_):m=_}else m=d;let f=z(this.getExtremum().max,m);g&&(f=a.formatBigNumber(f)),h+=c.horizontal.text.paddingLeft+c.horizontal.text.paddingRight+c.horizontal.text.borderSize*2+jt(f,c.horizontal.text.size,c.horizontal.text.weight,c.horizontal.text.family)}return Math.max(l,h)}convertFromPixel(t){var a,l;const e=((a=this.getParent().getYAxisWidget())==null?void 0:a.getBounding().height)??0,{min:s,range:i}=this.getExtremum(),r=(this.isReverse()?t/e:1-t/e)*i+s;switch(this.getType()){case $.Percentage:{const u=(l=this.getParent().getChart().getChartStore().getVisibleDataList()[0])==null?void 0:l.data;return(u==null?void 0:u.close)!==void 0?u.close*r/100+u.close:0}case $.Log:return Ct(r);default:return r}}convertToRealValue(t){let e=t;return this.getType()===$.Log&&(e=Ct(t)),e}convertToPixel(t){var s;let e=t;switch(this.getType()){case $.Percentage:{const r=(s=this.getParent().getChart().getChartStore().getVisibleDataList()[0])==null?void 0:s.data;(r==null?void 0:r.close)!==void 0&&(e=(t-r.close)/r.close*100);break}case $.Log:{e=Nt(t);break}default:e=t}return this._innerConvertToPixel(e)}convertToNicePixel(t){var i;const e=((i=this.getParent().getYAxisWidget())==null?void 0:i.getBounding().height)??0,s=this.convertToPixel(t);return Math.round(Math.max(e*.05,Math.min(s,e*.98)))}}class rs extends $e{getName(){return"indicator"}createAxisComponent(){return new Eo(this)}createMainWidget(t){return new es(t,this)}createSeparatorWidget(t){return new Oi(t,this)}createYAxisWidget(t){return new Io(t,this)}}class To extends rs{getName(){return"candle"}createMainWidget(t){return new Co(t,this)}createSeparatorWidget(){return null}}class Mo extends ss{getAxisStyles(t){return t.xAxis}createAxisLine(t,e){const s=e.axisLine.size/2;return{coordinates:[{x:0,y:s},{x:t.width,y:s}]}}createTickLines(t,e,s){const i=s.tickLine,o=s.axisLine.size;return t.map(r=>({coordinates:[{x:r.coord,y:0},{x:r.coord,y:o+i.length}]}))}createTickTexts(t,e,s){const i=s.tickText,o=s.axisLine.size,r=s.tickLine.length;return t.map(a=>({x:a.coord,y:o+r+i.marginStart,text:a.text,align:"center",baseline:"top"}))}}class Do extends is{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(t){return t.getInstances()}getProgressOverlay(t){return t.instance}getDefaultFigures(t,e,s,i,o,r,a,l,c,h){var d;const u=[];if(t.needDefaultXAxisFigure&&t.id===((d=h.instance)==null?void 0:d.id)){let g=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER;e.forEach((f,_)=>{g=Math.min(g,f.x),m=Math.max(m,f.x);const p=t.points[_];if(p.timestamp!==void 0){const v=r.formatDate(o,p.timestamp,"YYYY-MM-DD HH:mm",Z.Crosshair);u.push({type:"text",attrs:{x:f.x,y:0,text:v,align:"center"},ignoreEvent:!0})}}),e.length>1&&u.unshift({type:"rect",attrs:{x:g,y:0,width:m-g,height:s.height},ignoreEvent:!0})}return u}getFigures(t,e,s,i,o,r,a,l,c,h){var u;return((u=t.createXAxisFigures)==null?void 0:u.call(t,{overlay:t,coordinates:e,bounding:s,barSpace:i,precision:o,thousandsSeparator:r,dateTimeFormat:a,defaultStyles:l,xAxis:c,yAxis:h}))??[]}}class Po extends os{compare(t){return t.kLineData!==void 0&&t.dataIndex===t.realDataIndex}getDirectionStyles(t){return t.vertical}getText(t,e){var i;const s=(i=t.kLineData)==null?void 0:i.timestamp;return e.getCustomApi().formatDate(e.getTimeScaleStore().getDateTimeFormat(),s,"YYYY-MM-DD HH:mm",Z.Crosshair)}getTextAttrs(t,e,s,i,o,r){const a=s.realX;let l,c="center";return a-e/2-r.paddingLeft<0?(l=0,c="left"):a+e/2+r.paddingRight>i.width?(l=i.width,c="right"):l=a,{x:l,y:0,text:t,align:c,baseline:"top"}}}class Ao extends _e{constructor(t,e){super(t,e),this._xAxisView=new Mo(this),this._overlayXAxisView=new Do(this),this._crosshairVerticalLabelView=new Po(this),this.getContainer().style.cursor="ew-resize",this.addChild(this._overlayXAxisView)}getName(){return D.XAXIS}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class ko extends ns{calcExtremum(){const t=this.getParent().getChart().getChartStore(),{from:e,to:s}=t.getTimeScaleStore().getVisibleRange(),i=e,o=s-1,r=s-e;return{min:i,max:o,range:r,realMin:i,realMax:o,realRange:r}}optimalTicks(t){const e=this.getParent().getChart(),s=e.getChartStore(),i=s.getCustomApi().formatDate,o=[],r=t.length,a=s.getDataList();if(r>0){const l=s.getTimeScaleStore().getDateTimeFormat(),c=e.getStyles().xAxis.tickText,h=jt("00-00 00:00",c.size,c.weight,c.family),u=parseInt(t[0].value,10),d=this.convertToPixel(u);let g=1;if(r>1){const f=parseInt(t[1].value,10),_=this.convertToPixel(f),p=Math.abs(_-d);p<h&&(g=Math.ceil(h/p))}for(let f=0;f<r;f+=g){const _=parseInt(t[f].value,10),v=a[_].timestamp;let x=i(l,v,"HH:mm",Z.XAxis);if(f!==0){const y=parseInt(t[f-g].value,10),b=a[y].timestamp;x=this._optimalTickLabel(i,l,v,b)??x}const S=this.convertToPixel(_);o.push({text:x,coord:S,value:v})}if(o.length===1)o[0].text=i(l,o[0].value,"YYYY-MM-DD HH:mm",Z.XAxis);else{const f=o[0].value,_=o[1].value;if(o[2]!==void 0){const p=o[2].text;/^[0-9]{2}-[0-9]{2}$/.test(p)?o[0].text=i(l,f,"MM-DD",Z.XAxis):/^[0-9]{4}-[0-9]{2}$/.test(p)?o[0].text=i(l,f,"YYYY-MM",Z.XAxis):/^[0-9]{4}$/.test(p)&&(o[0].text=i(l,f,"YYYY",Z.XAxis))}else o[0].text=this._optimalTickLabel(i,l,f,_)??o[0].text}}return o}_optimalTickLabel(t,e,s,i){const o=t(e,s,"YYYY",Z.XAxis),r=t(e,s,"YYYY-MM",Z.XAxis),a=t(e,s,"MM-DD",Z.XAxis);return o!==t(e,i,"YYYY",Z.XAxis)?o:r!==t(e,i,"YYYY-MM",Z.XAxis)?r:a!==t(e,i,"MM-DD",Z.XAxis)?a:null}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,s=e.size;if(s!=="auto")return s;const i=t.crosshair;let o=0;e.show&&(e.axisLine.show&&(o+=e.axisLine.size),e.tickLine.show&&(o+=e.tickLine.length),e.tickText.show&&(o+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let r=0;return i.show&&i.vertical.show&&i.vertical.text.show&&(r+=i.vertical.text.paddingTop+i.vertical.text.paddingBottom+i.vertical.text.borderSize*2+i.vertical.text.size),Math.max(o,r)}convertTimestampFromPixel(t){const e=this.getParent().getChart().getChartStore().getTimeScaleStore(),s=e.coordinateToDataIndex(t);return e.dataIndexToTimestamp(s)}convertTimestampToPixel(t){const e=this.getParent().getChart().getChartStore().getTimeScaleStore(),s=e.timestampToDataIndex(t);return e.dataIndexToCoordinate(s)}convertFromPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)}}class Fo extends $e{getName(){return"xAxis"}createAxisComponent(){return new ko(this)}createMainWidget(t){return new Ao(t,this)}}function Fe(){return typeof window>"u"?!1:(window.navigator.userAgent.toLowerCase().indexOf("firefox")??-1)>-1}function re(){return typeof window>"u"?!1:/iPhone|iPad|iPod/.test(window.navigator.platform)}const Ro=10;class Lo{constructor(t,e,s){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!re(),this._onFirefoxOutsideMouseUp=i=>{this._mouseUpHandler(i)},this._onMobileSafariDoubleClick=i=>{if(this._firesTouchEvents(i)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(i),this._tapCoordinate);o<30&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(i),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:o}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(i),this._clickCoordinate);o<5&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(i),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}},this._target=t,this._handler=e,this._options=s,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){var o,r,a;(o=this._unsubscribeMousemove)==null||o.call(this),(r=this._unsubscribeMouseWheel)==null||r.call(this),(a=this._unsubscribeContextMenu)==null||a.call(this);const e=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",e)},this._target.addEventListener("mousemove",e);const s=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",s)},this._target.addEventListener("wheel",s,{passive:!1});const i=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",i)},this._target.addEventListener("contextmenu",i,{passive:!1}),!this._firesTouchEvents(t)&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(this._handler.mouseWheelHortEvent===void 0||(this._preventDefault(t),Math.abs(t.deltaX)===0))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(t),-t.deltaX)}else{if(this._handler.mouseWheelVertEvent===void 0)return;let e=-(t.deltaY/100);if(e===0)return;switch(this._preventDefault(t),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32;break}if(e!==0){const s=Math.sign(e)*Math.min(1,Math.abs(e));this._handler.mouseWheelVertEvent(this._makeCompatEvent(t),s)}}}_contextMenuHandler(t){this._preventDefault(t)}_touchMoveHandler(t){const e=this._touchWithId(t.changedTouches,this._activeTouchId);if(e===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const s=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),{xOffset:i,yOffset:o,manhattanDistance:r}=s;if(!(!this._touchMoveExceededManhattanDistance&&r<5)){if(!this._touchMoveExceededManhattanDistance){const a=i*.5,l=o>=a&&!this._options.treatVertDragAsPageScroll(),c=a>o&&!this._options.treatHorzDragAsPageScroll();!l&&!c&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(t){if(t.button!==0)return;const e=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate),{manhattanDistance:s}=e;s>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(t,e){const s=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y),o=s+i;return{xOffset:s,yOffset:i,manhattanDistance:o}}_touchEndHandler(t){let e=this._touchWithId(t.changedTouches,this._activeTouchId);if(e===null&&t.touches.length===0&&(e=t.changedTouches[0]),e===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const s=this._makeCompatEvent(t,e);if(this._processEvent(s,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);i<30&&!this._cancelTap&&this._processEvent(s,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(s,this._handler.tapEvent),this._handler.tapEvent!==void 0&&this._preventDefault(t));this._tapCount===0&&this._preventDefault(t),t.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}_mouseUpHandler(t){if(t.button!==0)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Fe()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);s<5&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(this._activeTouchId!==null)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);const s=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const i=this._touchMoveHandler.bind(this),o=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{s.removeEventListener("touchmove",i),s.removeEventListener("touchend",o)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",o,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),500)}this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(e))}_mouseDownHandler(t){if(t.button===2){this._preventDefault(t),this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);return}if(t.button!==0)return;const e=this._target.ownerDocument.documentElement;Fe()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const s=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",s),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",s),e.addEventListener("mouseup",i)}this._mousePressed=!0,!this._firesTouchEvents(t)&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(t)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const t=this._target.ownerDocument,e=s=>{this._handler.mouseDownOutsideEvent!=null&&(s.composed&&this._target.contains(s.composedPath()[0])||s.target!==null&&this._target.contains(s.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}re()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",t=>{if(t.button===1)return t.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){this._handler.pinchStartEvent===void 0&&this._handler.pinchEvent===void 0&&this._handler.pinchEndEvent===void 0||(this._target.addEventListener("touchstart",t=>this._checkPinchState(t.touches),{passive:!0}),this._target.addEventListener("touchmove",t=>{if(!(t.touches.length!==2||this._startPinchMiddleCoordinate===null)&&this._handler.pinchEvent!==void 0){const s=this._getTouchDistance(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},s),this._preventDefault(t)}},{passive:!1}),this._target.addEventListener("touchend",t=>{this._checkPinchState(t.touches)}))}_checkPinchState(t){t.length===1&&(this._pinchPrevented=!1),t.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){const e=this._target.getBoundingClientRect()??{left:0,top:0};this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),this._handler.pinchStartEvent!==void 0&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,this._handler.pinchEndEvent!==void 0&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(t){var e,s,i;(e=this._unsubscribeMousemove)==null||e.call(this),(s=this._unsubscribeMouseWheel)==null||s.call(this),(i=this._unsubscribeContextMenu)==null||i.call(this),!this._firesTouchEvents(t)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!re())}_longTapHandler(t){const e=this._touchWithId(t.touches,this._activeTouchId);e!==null&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(t){var e;return((e=t.sourceCapabilities)==null?void 0:e.firesTouchEvents)!==void 0?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+500}_processEvent(t,e){e==null||e.call(this._handler,t)}_makeCompatEvent(t,e){const s=e??t,i=this._target.getBoundingClientRect()??{left:0,top:0};return{x:s.clientX-i.left,y:s.clientY-i.top,pageX:s.pageX,pageY:s.pageY,isTouch:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",preventDefault:()=>{t.type!=="touchstart"&&this._preventDefault(t)}}}_getTouchDistance(t,e){const s=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(s*s+i*i)}_preventDefault(t){t.cancelable&&t.preventDefault()}_getCoordinate(t){return{x:t.pageX,y:t.pageY}}_eventTimeStamp(t){return t.timeStamp??performance.now()}_touchWithId(t,e){for(let s=0;s<t.length;++s)if(t[s].identifier===e)return t[s];return null}}class Bo{constructor(t,e){this._flingStartTime=new Date().getTime(),this._flingScrollRequestId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=s=>{if(s.shiftKey)switch(s.code){case"Equal":{this._chart.getChartStore().getTimeScaleStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().getTimeScaleStore().zoom(-.5);break}case"ArrowLeft":{const i=this._chart.getChartStore().getTimeScaleStore();i.startScroll(),i.scroll(-3*i.getBarSpace().bar);break}case"ArrowRight":{const i=this._chart.getChartStore().getTimeScaleStore();i.startScroll(),i.scroll(3*i.getBarSpace().bar);break}}},this._container=t,this._chart=e,this._event=new Lo(t,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(t,e){const{pane:s,widget:i}=this._findWidgetByEvent(t);if((s==null?void 0:s.getId())!==F.XAXIS&&(i==null?void 0:i.getName())===D.MAIN){const o=this._makeWidgetEvent(t,i),r=(e-this._pinchScale)*5;return this._pinchScale=e,this._chart.getChartStore().getTimeScaleStore().zoom(r,{x:o.x,y:o.y}),!0}return!1}mouseWheelHortEvent(t,e){const s=this._chart.getChartStore().getTimeScaleStore();return s.startScroll(),s.scroll(e),!0}mouseWheelVertEvent(t,e){var l;const{widget:s}=this._findWidgetByEvent(t),i=t.isTouch??!1,o=this._makeWidgetEvent(t,s);let r=null;const a=s==null?void 0:s.getName();if(i)if(a===D.MAIN||a===D.XAXIS)r={x:o.x,y:o.y};else{const c=(l=this._chart.getPaneById(F.CANDLE))==null?void 0:l.getBounding();r={x:c.width/2,y:c.height/2}}else a===D.MAIN&&(r={x:o.x,y:o.y});return r!==null?(this._chart.getChartStore().getTimeScaleStore().zoom(e,{x:o.x,y:o.y}),!0):!1}mouseDownEvent(t){const{pane:e,widget:s}=this._findWidgetByEvent(t);if(this._mouseDownWidget=s,s!==null){const i=this._makeWidgetEvent(t,s);switch(s.getName()){case D.SEPARATOR:return s.dispatchEvent("mouseDownEvent",i);case D.MAIN:{const r=(e==null?void 0:e.getAxisComponent().getExtremum())??null;return this._prevYAxisExtremum=r===null?r:{...r},this._startScrollCoordinate={x:i.x,y:i.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),s.dispatchEvent("mouseDownEvent",i)}case D.XAXIS:{const r=s.dispatchEvent("mouseDownEvent",i);return r&&this._chart.updatePane(A.Overlay),this._xAxisStartScaleCoordinate={x:i.x,y:i.y},this._xAxisStartScaleDistance=i.pageX,r}case D.YAXIS:{const r=s.dispatchEvent("mouseDownEvent",i);r&&this._chart.updatePane(A.Overlay);const a=(e==null?void 0:e.getAxisComponent().getExtremum())??null;return this._prevYAxisExtremum=a===null?a:{...a},this._yAxisStartScaleDistance=i.pageY,r}}}return!1}mouseMoveEvent(t){var o,r,a;const{pane:e,widget:s}=this._findWidgetByEvent(t),i=this._makeWidgetEvent(t,s);if((((o=this._mouseMoveTriggerWidgetInfo.pane)==null?void 0:o.getId())!==(e==null?void 0:e.getId())||((r=this._mouseMoveTriggerWidgetInfo.widget)==null?void 0:r.getName())!==(s==null?void 0:s.getName()))&&(s==null||s.dispatchEvent("mouseEnterEvent",i),(a=this._mouseMoveTriggerWidgetInfo.widget)==null||a.dispatchEvent("mouseLeaveEvent",i),this._mouseMoveTriggerWidgetInfo={pane:e,widget:s}),s!==null)switch(s.getName()){case D.MAIN:{const c=s.dispatchEvent("mouseMoveEvent",i),h=this._chart.getChartStore();let u={x:i.x,y:i.y,paneId:e==null?void 0:e.getId()};return c&&h.getTooltipStore().getActiveIcon()!==null&&(u=void 0,s!==null&&(s.getContainer().style.cursor="pointer")),this._chart.getChartStore().getTooltipStore().setCrosshair(u),c}case D.SEPARATOR:case D.XAXIS:case D.YAXIS:{const c=s.dispatchEvent("mouseMoveEvent",i);return this._chart.getChartStore().getTooltipStore().setCrosshair(),c}}return!1}pressedMouseMoveEvent(t){var i,o;if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===D.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);const{pane:e,widget:s}=this._findWidgetByEvent(t);if(s!==null&&((i=this._mouseDownWidget)==null?void 0:i.getPane().getId())===(e==null?void 0:e.getId())&&((o=this._mouseDownWidget)==null?void 0:o.getName())===s.getName()){const r=this._makeWidgetEvent(t,s);switch(s.getName()){case D.MAIN:{const l=s.getBounding(),c=s.dispatchEvent("pressedMouseMoveEvent",r);if(!c&&this._startScrollCoordinate!==null){const h=e==null?void 0:e.getAxisComponent();if(this._prevYAxisExtremum!==null&&!h.getAutoCalcTickFlag()&&h.getScrollZoomEnabled()){const{min:d,max:g,range:m}=this._prevYAxisExtremum;let f;(h==null?void 0:h.isReverse())??!1?f=this._startScrollCoordinate.y-r.y:f=r.y-this._startScrollCoordinate.y;const _=f/l.height,p=m*_,v=d+p,x=g+p,S=h.convertToRealValue(v),y=h.convertToRealValue(x);h.setExtremum({min:v,max:x,range:x-v,realMin:S,realMax:y,realRange:y-S})}const u=r.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(u)}return this._chart.getChartStore().getTooltipStore().setCrosshair({x:r.x,y:r.y,paneId:e==null?void 0:e.getId()}),c}case D.XAXIS:{const l=s.dispatchEvent("pressedMouseMoveEvent",r);if(l)this._chart.updatePane(A.Overlay);else{const c=e==null?void 0:e.getAxisComponent();if((c==null?void 0:c.getScrollZoomEnabled())??!0){const h=this._xAxisStartScaleDistance/r.pageX,u=(h-this._xAxisScale)*10;this._xAxisScale=h,this._chart.getChartStore().getTimeScaleStore().zoom(u,this._xAxisStartScaleCoordinate??void 0)}}return l}case D.YAXIS:{const l=s.dispatchEvent("pressedMouseMoveEvent",r);if(l)this._chart.updatePane(A.Overlay);else{const c=e==null?void 0:e.getAxisComponent();if(this._prevYAxisExtremum!==null&&c.getScrollZoomEnabled()){const{min:h,max:u,range:d}=this._prevYAxisExtremum,g=r.pageY/this._yAxisStartScaleDistance,m=d*g,f=(m-d)/2,_=h-f,p=u+f,v=e==null?void 0:e.getAxisComponent(),x=v.convertToRealValue(_),S=v.convertToRealValue(p);v.setExtremum({min:_,max:p,range:m,realMin:x,realMax:S,realRange:S-x}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}}return l}}}return!1}mouseUpEvent(t){const{widget:e}=this._findWidgetByEvent(t);let s=!1;if(e!==null){const i=this._makeWidgetEvent(t,e);switch(e.getName()){case D.MAIN:case D.SEPARATOR:case D.XAXIS:case D.YAXIS:{s=e.dispatchEvent("mouseUpEvent",i);break}}s&&this._chart.updatePane(A.Overlay)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,s}mouseClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(e!==null){const s=this._makeWidgetEvent(t,e);return e.dispatchEvent("mouseClickEvent",s)}return!1}mouseRightClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);let s=!1;if(e!==null){const i=this._makeWidgetEvent(t,e);switch(e.getName()){case D.MAIN:case D.XAXIS:case D.YAXIS:{s=e.dispatchEvent("mouseRightClickEvent",i);break}}s&&this._chart.updatePane(A.Overlay)}return!1}mouseDoubleClickEvent(t){const{pane:e,widget:s}=this._findWidgetByEvent(t);if(s!==null)switch(s.getName()){case D.MAIN:{const o=this._makeWidgetEvent(t,s);return s.dispatchEvent("mouseDoubleClickEvent",o)}case D.YAXIS:{const o=e==null?void 0:e.getAxisComponent();if(!o.getAutoCalcTickFlag())return o.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().getTooltipStore().setCrosshair(),!0}touchStartEvent(t){const{pane:e,widget:s}=this._findWidgetByEvent(t);if(s!==null){const i=this._makeWidgetEvent(t,s);switch(s.getName()){case D.MAIN:{const r=this._chart.getChartStore(),a=r.getTooltipStore();if(s.dispatchEvent("mouseDownEvent",i))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,a.setCrosshair(void 0,!0),this._chart.updatePane(A.Overlay),!0;if(this._flingScrollRequestId!==null&&(qt(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime(),this._startScrollCoordinate={x:i.x,y:i.y},r.getTimeScaleStore().startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const l=i.x-this._touchCoordinate.x,c=i.y-this._touchCoordinate.y;Math.sqrt(l*l+c*c)<Ro?(this._touchCoordinate={x:i.x,y:i.y},a.setCrosshair({x:i.x,y:i.y,paneId:e==null?void 0:e.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,a.setCrosshair())}return!0}case D.XAXIS:case D.YAXIS:{const r=s.dispatchEvent("mouseDownEvent",i);return r&&this._chart.updatePane(A.Overlay),r}}}return!1}touchMoveEvent(t){var i,o,r;const{pane:e,widget:s}=this._findWidgetByEvent(t);if(s!==null){const a=this._makeWidgetEvent(t,s),l=s.getName(),c=this._chart.getChartStore(),h=c.getTooltipStore();switch(l){case D.MAIN:{if(s.dispatchEvent("pressedMouseMoveEvent",a))return(i=a.preventDefault)==null||i.call(a),h.setCrosshair(void 0,!0),this._chart.updatePane(A.Overlay),!0;if(this._touchCoordinate!==null)(o=a.preventDefault)==null||o.call(a),h.setCrosshair({x:a.x,y:a.y,paneId:e==null?void 0:e.getId()});else if(this._startScrollCoordinate!==null&&Math.abs(this._startScrollCoordinate.x-a.x)>this._startScrollCoordinate.y-a.y){const u=a.x-this._startScrollCoordinate.x;c.getTimeScaleStore().scroll(u)}return!0}case D.XAXIS:case D.YAXIS:{const u=s.dispatchEvent("pressedMouseMoveEvent",a);return u&&((r=a.preventDefault)==null||r.call(a),this._chart.updatePane(A.Overlay)),u}}}return!1}touchEndEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(e!==null){const s=this._makeWidgetEvent(t,e);switch(e.getName()){case D.MAIN:{if(e.dispatchEvent("mouseUpEvent",s),this._startScrollCoordinate!==null){const o=new Date().getTime()-this._flingStartTime;let a=(s.x-this._startScrollCoordinate.x)/(o>0?o:1)*20;if(o<200&&Math.abs(a)>0){const l=this._chart.getChartStore().getTimeScaleStore(),c=()=>{this._flingScrollRequestId=ce(()=>{l.startScroll(),l.scroll(a),a=a*(1-.025),Math.abs(a)<1?this._flingScrollRequestId!==null&&(qt(this._flingScrollRequestId),this._flingScrollRequestId=null):c()})};c()}}return!0}case D.XAXIS:case D.YAXIS:e.dispatchEvent("mouseUpEvent",s)&&this._chart.updatePane(A.Overlay)}}return!1}tapEvent(t){const{pane:e,widget:s}=this._findWidgetByEvent(t);let i=!1;if(s!==null){const o=this._makeWidgetEvent(t,s),r=s.dispatchEvent("mouseClickEvent",o);if(s.getName()===D.MAIN){const a=this._makeWidgetEvent(t,s),c=this._chart.getChartStore().getTooltipStore();r?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,!0),i=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:a.x,y:a.y},c.setCrosshair({x:a.x,y:a.y,paneId:e==null?void 0:e.getId()},!0),i=!0),this._touchCancelCrosshair=!1)}(i||r)&&this._chart.updatePane(A.Overlay)}return i}doubleTapEvent(t){return this.mouseDoubleClickEvent(t)}longTapEvent(t){const{pane:e,widget:s}=this._findWidgetByEvent(t);if(s!==null&&s.getName()===D.MAIN){const i=this._makeWidgetEvent(t,s);return this._touchCoordinate={x:i.x,y:i.y},this._chart.getChartStore().getTooltipStore().setCrosshair({x:i.x,y:i.y,paneId:e==null?void 0:e.getId()}),!0}return!1}_findWidgetByEvent(t){const e=this._chart.getAllPanes(),{x:s,y:i}=t;let o=null;for(const[,a]of e){const l=a.getBounding();if(s>=l.left&&s<=l.left+l.width&&i>=l.top&&i<=l.top+l.height){o=a;break}}o===null&&(o=this._chart.getPaneById(F.XAXIS));let r=null;if(o!==null){const a=o.getSeparatorWidget();if(a!==null){const l=a.getBounding();s>=l.left&&s<=l.left+l.width&&i>=l.top&&i<=l.top+Dt&&(r=a)}if(r===null){const l=o.getMainWidget(),c=l.getBounding();s>=c.left&&s<=c.left+c.width&&i>=c.top&&i<=c.top+c.height&&(r=l)}if(r===null){const l=o.getYAxisWidget();if(l!==null){const c=l.getBounding();s>=c.left&&s<=c.left+c.width&&i>=c.top&&i<=c.top+c.height&&(r=l)}}}return{pane:o,widget:r}}_makeWidgetEvent(t,e){const s=(e==null?void 0:e.getBounding())??null;return{...t,x:t.x-((s==null?void 0:s.left)??0),y:t.y-((s==null?void 0:s.top)??0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}class as{constructor(t,e){this._panes=new Map,this._initContainer(t),this._chartEvent=new Bo(this._chartContainer,this),this._chartStore=new Zi(this,e),this._xAxisPane=new Fo(this._chartContainer,this,F.XAXIS),this._panes.set(F.CANDLE,new To(this._chartContainer,this,F.CANDLE)),this.adjustPaneViewport(!0,!0,!0)}_initContainer(t){this._container=t,this._chartContainer=ct("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}_measurePaneHeight(){var a;const t=this._container.offsetHeight,e=this._xAxisPane.getAxisComponent().getAutoSize();let s=t-e;s<0&&(s=0);let i=0;this._panes.forEach(l=>{if(l.getId()!==F.CANDLE){let c=l.getBounding().height;const h=l.getOptions().minHeight;c<h&&(c=h),i+c>s?(i=s,c=Math.max(s-i,0)):i+=c,l.setBounding({height:c})}});const o=s-i;(a=this._panes.get(F.CANDLE))==null||a.setBounding({height:o});let r=0;this._panes.forEach(l=>{l.setBounding({top:r}),r+=l.getBounding().height}),this._xAxisPane.setBounding({height:e,top:r})}_measurePaneWidth(){const e=this._chartStore.getStyles().yAxis,s=e.position===Pt.Left,i=!e.inside,o=this._container.offsetWidth;let r=0,a=Number.MIN_SAFE_INTEGER,l=0,c=0;this._panes.forEach(g=>{a=Math.max(a,g.getAxisComponent().getAutoSize())}),a>o&&(a=o),i?(r=o-a,s?(l=0,c=a):(l=o-a,c=0)):(r=o,c=0,s?l=0:l=o-a),this._chartStore.getTimeScaleStore().setTotalBarSpace(r);const h={width:o},u={width:r,left:c},d={width:a,left:l};this._panes.forEach(g=>{g.setBounding(h,u,d)}),this._xAxisPane.setBounding(h,u,d)}_setPaneOptions(t,e){const s=this._panes.get((t==null?void 0:t.id)??"");let i=!1;if(s!==void 0){let o=e;if(t.id!==F.CANDLE&&t.height!==void 0&&t.height>0){const r=Math.max(t.minHeight??s.getOptions().minHeight,0),a=Math.max(r,t.height);s.setBounding({height:a}),o=!0,i=!0}s.setOptions(t),o&&this.adjustPaneViewport(i,!0,!0,!0,!0)}}getContainer(){return this._container}getChartStore(){return this._chartStore}getAllPanes(){return this._panes}adjustPaneViewport(t,e,s,i,o){t&&this._measurePaneHeight();let r=e;const a=i??!1,l=o??!1;(a||l)&&this._panes.forEach(c=>{const h=c.getAxisComponent().buildTicks(l);r||(r=h)}),r&&this._measurePaneWidth(),(s??!1)&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(A.All))}updatePane(t,e){var s;e!==void 0?(s=this.getPaneById(e))==null||s.update(t):(this._xAxisPane.update(t),this._panes.forEach(i=>{i.update(t)}))}getPaneById(t){return t===F.XAXIS?this._xAxisPane:this._panes.get(t)??null}crosshairChange(t){const e=this._chartStore.getActionStore();if(e.has(lt.OnCrosshairChange)){const s={};this._panes.forEach((i,o)=>{const r={};this._chartStore.getIndicatorStore().getInstances(o).forEach(l=>{const c=l.result;r[l.name]=c[t.dataIndex??c.length-1]}),s[o]=r}),t.paneId!==void 0&&e.execute(lt.OnCrosshairChange,{...t,indicatorData:s})}}getDom(t,e){var s;if(t!==void 0){const i=this.getPaneById(t);if(i!==null)switch(e??"root"){case"root":return i.getContainer();case"main":return i.getMainWidget().getContainer();case"yAxis":return((s=i.getYAxisWidget())==null?void 0:s.getContainer())??null}}else return this._chartContainer;return null}getSize(t,e){var s;if(t!==void 0){const i=this.getPaneById(t);if(i!==null)switch(e??"root"){case"root":return i.getBounding();case"main":return i.getMainWidget().getBounding();case"yAxis":return((s=i.getYAxisWidget())==null?void 0:s.getBounding())??null}}else return{width:this._chartContainer.offsetWidth,height:this._chartContainer.offsetHeight,left:0,top:0,right:0,bottom:0};return null}setStyles(t){var s,i;this._chartStore.setOptions({styles:t});let e;ot(t)?e=Ge(t):e=t,((s=e==null?void 0:e.yAxis)==null?void 0:s.type)!==void 0&&((i=this.getPaneById(F.CANDLE))==null||i.getAxisComponent().setAutoCalcTickFlag(!0)),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getStyles(){return this._chartStore.getStyles()}setLocale(t){this._chartStore.setOptions({locale:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getLocale(){return this._chartStore.getLocale()}setCustomApi(t){this._chartStore.setOptions({customApi:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}setPriceVolumePrecision(t,e){this._chartStore.setPrecision({price:t,volume:e})}getPriceVolumePrecision(){return this._chartStore.getPrecision()}setTimezone(t){this._chartStore.setOptions({timezone:t}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(A.Drawer)}getTimezone(){return this._chartStore.getTimeScaleStore().getTimezone()}setOffsetRightDistance(t){this._chartStore.getTimeScaleStore().setOffsetRightDistance(t,!0)}getOffsetRightDistance(){return this._chartStore.getTimeScaleStore().getOffsetRightDistance()}setLeftMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.getTimeScaleStore().setBarSpace(t)}getBarSpace(){return this._chartStore.getTimeScaleStore().getBarSpace().bar}getVisibleRange(){return this._chartStore.getTimeScaleStore().getVisibleRange()}clearData(){this._chartStore.clear()}getDataList(){return this._chartStore.getDataList()}applyNewData(t,e,s){this._chartStore.clear(),t.length===0?this.adjustPaneViewport(!1,!0,!0,!0):this.applyMoreData(t,e,s)}applyMoreData(t,e,s){this._chartStore.addData(t,0,e),t.length>0&&this._chartStore.getIndicatorStore().calcInstance().then(i=>{this.adjustPaneViewport(!1,!0,!0,!0),s==null||s()}).catch(i=>{})}updateData(t,e){const s=this._chartStore.getDataList(),i=s.length,o=t.timestamp,r=N(s[i-1],"timestamp",0);if(o>=r){let a=i;o===r&&(a=i-1),this._chartStore.addData(t,a),this._chartStore.getIndicatorStore().calcInstance().then(l=>{this.adjustPaneViewport(!1,!0,!0,!0),e==null||e()}).catch(l=>{})}}loadMore(t){this._chartStore.getTimeScaleStore().setLoadMoreCallback(t)}createIndicator(t,e,s,i){const o=ot(t)?{name:t}:t;if(We(o.name)===null)return null;let r;if(X(s)&&ot(s==null?void 0:s.id)&&this._panes.has(s.id))r=s.id,this._chartStore.getIndicatorStore().addInstance(o,r,e??!1).then(a=>{var l;this._setPaneOptions(s,((l=this._panes.get(r))==null?void 0:l.getAxisComponent().buildTicks(!0))??!1)}).catch(a=>{});else{r=(s==null?void 0:s.id)??Ne(F.INDICATOR);const a=Array.from(this._panes.values()).pop(),l=new rs(this._chartContainer,this,r,a);a.setBottomPane(l);const c=(s==null?void 0:s.height)??zi;l.setBounding({height:c}),X(s)&&l.setOptions(s),this._panes.set(r,l),this._chartStore.getIndicatorStore().addInstance(o,r,e??!1).finally(()=>{this.adjustPaneViewport(!0,!0,!0,!0,!0),i==null||i()})}return r}overrideIndicator(t,e,s){this._chartStore.getIndicatorStore().override(t,e??null).then(([i,o])=>{(i||o)&&(this.adjustPaneViewport(!1,o,!0,o),s==null||s())}).catch(()=>{})}getIndicatorByPaneId(t,e){return this._chartStore.getIndicatorStore().getInstanceByPaneId(t,e)}removeIndicator(t,e){const s=this._chartStore.getIndicatorStore();if(s.removeInstance(t,e)){let o=!1;if(t!==F.CANDLE&&!s.hasInstances(t)){const r=this._panes.get(t);if(r!==void 0){o=!0;const a=r.getTopPane(),l=r.getBottomPane();l==null||l.setTopPane(a),a==null||a.setBottomPane(l),r==null||r.destroy(),this._panes.delete(t)}}this.adjustPaneViewport(o,!0,!0,!0,!0)}}createOverlay(t,e){let s=[];ot(t)?s=[{name:t}]:nt(t)?s=t.map(r=>ot(r)?{name:r}:r):s=[t];let i=!0;(e===void 0||this.getPaneById(e)===null)&&(e=F.CANDLE,i=!1);const o=this._chartStore.getOverlayStore().addInstances(s,e,i);return nt(t)?o:o[0]}getOverlayById(t){return this._chartStore.getOverlayStore().getInstanceById(t)}overrideOverlay(t){this._chartStore.getOverlayStore().override(t)}removeOverlay(t){let e;t!==void 0&&(ot(t)?e={id:t}:e=t),this._chartStore.getOverlayStore().removeInstance(e)}setPaneOptions(t){this._setPaneOptions(t,!1)}setZoomEnabled(t){this._chartStore.getTimeScaleStore().setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.getTimeScaleStore().getZoomEnabled()}setScrollEnabled(t){this._chartStore.getTimeScaleStore().setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.getTimeScaleStore().getScrollEnabled()}scrollByDistance(t,e){const s=e===void 0||e<0?0:e,i=this._chartStore.getTimeScaleStore();if(s>0){i.startScroll();const o=new Date().getTime(),r=()=>{const a=(new Date().getTime()-o)/s,l=a>=1,c=l?t:t*a;i.scroll(c),l||requestAnimationFrame(r)};r()}else i.startScroll(),i.scroll(t)}scrollToRealTime(t){const e=this._chartStore.getTimeScaleStore(),{bar:s}=e.getBarSpace(),o=(e.getOffsetRightBarCount()-e.getInitialOffsetRightDistance()/s)*s;this.scrollByDistance(o,t)}scrollToDataIndex(t,e){const s=this._chartStore.getTimeScaleStore(),i=(s.getOffsetRightBarCount()+(this.getDataList().length-1-t))*s.getBarSpace().bar;this.scrollByDistance(i,e)}scrollToTimestamp(t,e){const s=le(this.getDataList(),"timestamp",t);this.scrollToDataIndex(s,e)}zoomAtCoordinate(t,e,s){const i=s===void 0||s<0?0:s,o=this._chartStore.getTimeScaleStore();if(i>0){const{bar:r}=o.getBarSpace(),l=r*t-r,c=new Date().getTime(),h=()=>{const u=(new Date().getTime()-c)/i,d=u>=1,g=d?l:l*u;o.zoom(g/r,e),d||requestAnimationFrame(h)};h()}else o.zoom(t,e)}zoomAtDataIndex(t,e,s){const i=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:i,y:0},s)}zoomAtTimestamp(t,e,s){const i=le(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,i,s)}convertToPixel(t,e){const{paneId:s=F.CANDLE,absolute:i=!1}=e;let o=[];if(s!==F.XAXIS){const r=this.getPaneById(s);if(r!==null){const a=this._chartStore.getTimeScaleStore(),l=r.getBounding(),c=new Array().concat(t),h=this._xAxisPane.getAxisComponent(),u=r.getAxisComponent();o=c.map(d=>{const g={};let m=d.dataIndex;if(d.timestamp!==void 0&&(m=a.timestampToDataIndex(d.timestamp)),m!==void 0&&(g.x=h==null?void 0:h.convertToPixel(m)),d.value!==void 0){const f=u==null?void 0:u.convertToPixel(d.value);g.y=i?l.top+f:f}return g})}}return nt(t)?o:o[0]??{}}convertFromPixel(t,e){const{paneId:s=F.CANDLE,absolute:i=!1}=e;let o=[];if(s!==F.XAXIS){const r=this.getPaneById(s);if(r!==null){const a=this._chartStore.getTimeScaleStore(),l=r.getBounding(),c=new Array().concat(t),h=this._xAxisPane.getAxisComponent(),u=r.getAxisComponent();o=c.map(d=>{const g={};if(d.x!==void 0){const m=h.convertFromPixel(d.x);g.dataIndex=m,g.timestamp=a.dataIndexToTimestamp(m)??void 0}if(d.y!==void 0){const m=i?d.y-l.top:d.y;g.value=u.convertFromPixel(m)}return g})}}return nt(t)?o:o[0]??{}}executeAction(t,e){switch(t){case lt.OnCrosshairChange:{const s={...e};s.paneId=s.paneId??F.CANDLE,this._chartStore.getTooltipStore().setCrosshair(s);break}}}subscribeAction(t,e){this._chartStore.getActionStore().subscribe(t,e)}unsubscribeAction(t,e){this._chartStore.getActionStore().unsubscribe(t,e)}getConvertPictureUrl(t,e,s){const i=this._chartContainer.offsetWidth,o=this._chartContainer.offsetHeight,r=ct("canvas",{width:`${i}px`,height:`${o}px`,boxSizing:"border-box"}),a=r.getContext("2d"),l=yt(r);r.width=i*l,r.height=o*l,a.scale(l,l),a.fillStyle=s??"#FFFFFF",a.fillRect(0,0,i,o);const c=t??!1;this._panes.forEach(u=>{const d=u.getBounding();a.drawImage(u.getImage(c),0,d.top,i,d.height)});const h=this._xAxisPane.getBounding();return a.drawImage(this._xAxisPane.getImage(c),0,h.top,i,h.height),r.toDataURL(`image/${e??"jpeg"}`)}resize(){this.adjustPaneViewport(!0,!0,!0,!0,!0)}destroy(){this._chartEvent.destroy(),this._panes.forEach(t=>{t.destroy()}),this._panes.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer)}}const Kt=new Map;let Vo=1;function cn(n,t){let e;if(ot(n)?e=document.getElementById(n):e=n,e===null)return null;let s=Kt.get(e.id);if(s!==void 0)return s;const i=`k_line_chart_${Vo++}`;return s=new as(e,t),s.id=i,e.setAttribute("k-line-chart-id",i),Kt.set(i,s),s}function hn(n){var e;let t;if(n instanceof as)t=n.id;else{let s;ot(n)?s=document.getElementById(n):s=n,t=(s==null?void 0:s.getAttribute("k-line-chart-id"))??null}t!==null&&((e=Kt.get(t))==null||e.destroy(),Kt.delete(t))}const No={class:"tooltip"},Oo={class:"body"},Wo={class:"tip-box"},zo={class:"tip"},Xo={__name:"Tooltip",props:["tip"],setup(n){const t=n;return(e,s)=>(Tt(),Mt("div",No,[q("span",Oo,[Le(e.$slots,"default",{},void 0,!0)]),q("div",Wo,[q("span",zo,ls(t.tip),1)])]))}},$t=Re(Xo,[["__scopeId","data-v-def51854"]]);const te=n=>(ds("data-v-a4d9e783"),n=n(),gs(),n),Yo={class:"root sample-root"},Ho={class:"chart-box"},$o={class:"code-action-box"},Zo={key:0,target:"_blank",href:""},Go=te(()=>q("svg",{viewBox:"0 0 1024 1024"},[q("path",{d:"M911.7 385.3l-0.3-1.5c-0.2-1-0.3-1.9-0.6-2.9-0.2-0.6-0.4-1.1-0.5-1.7-0.3-0.8-0.5-1.7-0.9-2.5-0.2-0.6-0.5-1.1-0.8-1.7-0.4-0.8-0.8-1.5-1.2-2.3-0.3-0.5-0.6-1.1-1-1.6-0.8-1.2-1.7-2.4-2.6-3.6-0.5-0.6-1.1-1.3-1.7-1.9-0.4-0.5-0.9-0.9-1.4-1.3-0.6-0.6-1.3-1.1-1.9-1.6-0.5-0.4-1-0.8-1.6-1.2-0.2-0.1-0.4-0.3-0.6-0.4L531.1 117.8c-11.5-7.7-26.6-7.7-38.1 0L127.3 361.3c-0.2 0.1-0.4 0.3-0.6 0.4-0.5 0.4-1 0.8-1.6 1.2-0.7 0.5-1.3 1.1-1.9 1.6-0.5 0.4-0.9 0.9-1.4 1.3-0.6 0.6-1.2 1.2-1.7 1.9-1 1.1-1.8 2.3-2.6 3.6-0.3 0.5-0.7 1-1 1.6-0.4 0.7-0.8 1.5-1.2 2.3-0.3 0.5-0.5 1.1-0.8 1.7-0.3 0.8-0.6 1.7-0.9 2.5-0.2 0.6-0.4 1.1-0.5 1.7-0.2 0.9-0.4 1.9-0.6 2.9l-0.3 1.5c-0.2 1.5-0.3 3-0.3 4.5v243.5c0 1.5 0.1 3 0.3 4.5l0.3 1.5c0.2 1 0.4 1.9 0.6 2.9 0.2 0.6 0.3 1.1 0.5 1.7 0.3 0.9 0.6 1.7 0.9 2.5 0.2 0.6 0.5 1.1 0.8 1.7 0.4 0.8 0.7 1.5 1.2 2.3 0.3 0.5 0.6 1.1 1 1.6 0.5 0.7 0.9 1.4 1.5 2.1l1.2 1.5c0.5 0.6 1.1 1.3 1.7 1.9 0.4 0.5 0.9 0.9 1.4 1.3 0.6 0.6 1.3 1.1 1.9 1.6 0.5 0.4 1 0.8 1.6 1.2 0.2 0.1 0.4 0.3 0.6 0.4L493 905.7c5.6 3.8 12.3 5.8 19.1 5.8 6.6 0 13.3-1.9 19.1-5.8l365.6-243.5c0.2-0.1 0.4-0.3 0.6-0.4 0.5-0.4 1-0.8 1.6-1.2 0.7-0.5 1.3-1.1 1.9-1.6 0.5-0.4 0.9-0.9 1.4-1.3 0.6-0.6 1.2-1.2 1.7-1.9l1.2-1.5 1.5-2.1c0.3-0.5 0.7-1 1-1.6 0.4-0.8 0.8-1.5 1.2-2.3 0.3-0.5 0.5-1.1 0.8-1.7 0.3-0.8 0.6-1.7 0.9-2.5 0.2-0.5 0.4-1.1 0.5-1.7 0.3-0.9 0.4-1.9 0.6-2.9l0.3-1.5c0.2-1.5 0.3-3 0.3-4.5V389.8c-0.3-1.5-0.4-3-0.6-4.5zM546.4 210.5l269.4 179.4-120.3 80.4-149-99.6V210.5z m-68.8 0v160.2l-149 99.6-120.3-80.4 269.3-179.4zM180.7 454.1l86 57.5-86 57.5v-115z m296.9 358.5L208.3 633.2l120.3-80.4 149 99.6v160.2zM512 592.8l-121.6-81.2L512 430.3l121.6 81.2L512 592.8z m34.4 219.8V652.4l149-99.6 120.3 80.4-269.3 179.4zM843.3 569l-86-57.5 86-57.5v115z"})],-1)),jo={key:1},Uo=te(()=>q("svg",{viewBox:"0 0 1024 1024"},[q("path",{d:"M709.6 210l0.4-0.2h0.2L512 96 313.9 209.8h-0.2l0.7 0.3L151.5 304v416L512 928l360.5-208V304l-162.9-94zM482.7 843.6L339.6 761V621.4L210 547.8V372.9l272.7 157.3v313.4zM238.2 321.5l134.7-77.8 138.9 79.7 139.1-79.9 135.2 78-273.9 158-274-158zM814 548.3l-128.8 73.1v139.1l-143.9 83V530.4L814 373.1v175.2z"})],-1)),qo={key:2},Ko=te(()=>q("svg",{viewBox:"0 0 1024 1024"},[q("path",{d:"M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9 23.5 23.2 38.1 55.4 38.1 91v112.5c0.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"})],-1)),Jo=["href"],Qo={viewBox:"0 0 1024 1024",style:{width:"17px",height:"17px"}},tn=te(()=>q("path",{d:"M256 256V149.333333c0-58.88 47.829333-106.666667 106.666667-106.666666h512c58.88 0 106.666667 47.829333 106.666666 106.666666v512c0 58.88-47.829333 106.666667-106.666666 106.666667h-106.666667v106.666667c0 58.88-47.829333 106.666667-106.666667 106.666666H149.333333c-58.88 0-106.666667-47.829333-106.666666-106.666666V362.666667c0-58.88 47.829333-106.666667 106.666666-106.666667h106.666667z m0 85.333333H149.333333c-11.733333 0-21.333333 9.6-21.333333 21.333334v512c0 11.733333 9.6 21.333333 21.333333 21.333333h512c11.733333 0 21.333333-9.6 21.333334-21.333333v-106.666667H362.666667c-58.88 0-106.666667-47.829333-106.666667-106.666667V341.333333z m85.333333-192v512c0 11.733333 9.6 21.333333 21.333334 21.333334h512c11.733333 0 21.333333-9.6 21.333333-21.333334V149.333333c0-11.733333-9.6-21.333333-21.333333-21.333333H362.666667c-11.733333 0-21.333333 9.6-21.333334 21.333333z"},null,-1)),en=[tn],sn={__name:"Container",props:["codePane","codeSandbox","github"],setup(n){const{lang:t}=cs(),e=hs(),s=n;return us(()=>{e.value=location.href}),(i,o)=>(Tt(),Mt("div",Yo,[q("div",Ho,[Le(i.$slots,"default",{},void 0,!0)]),q("div",$o,[s.codePane?(Tt(),Mt("a",Zo,[Xt($t,{tip:Ht(t)==="zh-CN"?"在 CodePen 中打开":"Open in CodePen"},{default:Yt(()=>[Go]),_:1},8,["tip"])])):oe("",!0),s.codeSandbox?(Tt(),Mt("a",jo,[Xt($t,{tip:Ht(t)==="zh-CN"?"在 CodeSandbox 中打开":"Open in CodeSandbox"},{default:Yt(()=>[Uo]),_:1},8,["tip"])])):oe("",!0),s.github?(Tt(),Mt("a",qo,[Xt($t,{tip:Ht(t)==="zh-CN"?"在 Github 中打开":"Open in Github"},{default:Yt(()=>[Ko]),_:1},8,["tip"])])):oe("",!0),q("a",{target:"_blank",href:e.value},[Xt($t,{tip:Ht(t)==="zh-CN"?"在新窗口中打开":"Open in a new window"},{default:Yt(()=>[(Tt(),Mt("svg",Qo,en))]),_:1},8,["tip"])],8,Jo)])]))}},un=Re(sn,[["__scopeId","data-v-a4d9e783"]]);function dn(n=new Date().getTime(),t=800){let e=5e3;n=Math.floor(n/1e3/60)*60*1e3-t*60*1e3;const s=[];for(let i=0;i<t;i++){const o=[];for(let d=0;d<4;d++)o.push(e+Math.random()*60-30);o.sort();const r=+o[Math.round(Math.random()*3)].toFixed(2),a=+o[3].toFixed(2),l=+o[0].toFixed(2),c=+o[Math.round(Math.random()*3)].toFixed(2),h=Math.round(Math.random()*100)+10,u=(r+a+l+c)/4*h;s.push({timestamp:n,open:r,high:a,low:l,close:c,volume:h,turnover:u}),e=c,n+=60*1e3}return s}export{un as C,nn as a,rn as b,an as c,hn as d,dn as g,cn as i,ln as r};
